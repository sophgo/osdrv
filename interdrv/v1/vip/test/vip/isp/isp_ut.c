#include "isp_ut.h"
#include <ut_common.h>

#include <linux/cvi_vip.h>
#include <linux/cvi_vip_isp.h>

#define ISP_ALLOC_BASE 0x110000000
#define ISP_BUF_NUM 3
#define ISP_BUF_PLANE 3
#define STS_BUF_NUM 2

//#define OS08A20
#define IMX327

const char *dev_isp = "/dev/video0";
int ut_fd_isp;

struct isp_cfg {
	struct size		s;
	uint32_t		pxlfmt;
	enum v4l2_buf_type	buf_type;
	enum v4l2_memory	mem_type;
	uint16_t		buf_num;
	uint16_t		buf_plane_num;
	uint64_t		alloc_base;
	struct isp_tuning_cfg	tun_buf;
	uint8_t			tuning_idx[ISP_PRERAW_MAX];
	uint8_t			isp_devm_fd;
};

struct isp_cfg i_cfg = {
#if defined(IMX327)
	.s = {1920, 1080},
#elif defined(OS08A20)
	.s = {3840, 2160},
#else
	.s = {1280, 720},
#endif
	.pxlfmt = V4L2_PIX_FMT_YUV420M,
	.buf_type = V4L2_BUF_TYPE_VIDEO_CAPTURE_MPLANE,
	.mem_type = V4L2_MEMORY_USERPTR,
	.buf_num = ISP_BUF_NUM,
	.buf_plane_num = ISP_BUF_PLANE,
	.alloc_base = ISP_ALLOC_BASE,
};

struct v4l2_plane isp_v4l2_planes[ISP_BUF_NUM][ISP_BUF_PLANE];
struct v4l2_buffer isp_v4l2_bufs[ISP_BUF_NUM];
struct cvi_isp_sts_mem stsBuf[ISP_PRERAW_MAX][STS_BUF_NUM];
static uint8_t dq_buf_idx;

/*************************************************************
 *
 *************************************************************/


uint8_t ut_bnr_intensity_sel[8] = {7, 6, 5, 4, 3, 2, 1, 0};

uint8_t ut_bnr_weight_lut[256] = {
	31, 16, 8,  4,	2,  1,	1,  1,	1,  2,	2,  4,	4,  8,	8,  0,
	0,  0,	0,  0,	0,  0,	0,  0,	0,  0,	0,  0,	0,  0,	0,  0,
	0,  0,	0,  0,	0,  0,	0,  0,	0,  0,	0,  0,	0,  0,	0,  0,
	0,  0,	0,  0,	0,  0,	0,  0,	0,  0,	0,  0,	0,  0,	0,  0,
	0,  0,	0,  0,	0,  0,	0,  0,	0,  0,	0,  0,	0,  0,	0,  0,
	0,  0,	0,  0,	0,  0,	0,  16,	0,  16,	0,  0,	0,  0,	0,  0,
	0,  0,	0,  0,	0,  0,	0,  0,	0,  0,	0,  0,	0,  32,	32,  0,
	0,  0,	0,  0,	0,  0,	0,  0,	0,  0,	0,  0,	0,  0,	0,  0,
	0,  0,	0,  0,	0,  0,	0,  0,	0,  0,	0,  0,	0,  0,	0,  0,
	0,  0,	0,  0,	0,  0,	0,  0,	0,  0,	0,  0,	0,  0,	0,  0,
	0,  0,	0,  0,	0,  0,	0,  0,	0,  0,	0,  0,	0,  0,	0,  0,
	0,  0,	0,  0,	0,  0,	0,  0,	0,  0,	0,  0,	0,  0,	0,  0,
	0,  0,	0,  0,	0,  0,	0,  0,	0,  0,	0,  0,	0,  0,	0,  0,
	0,  0,	0,  0,	0,  0,	0,  0,	0,  0,	0,  0,	0,  0,	0,  0,
	0,  0,	0,  0,	0,  0,	0,  0,	0,  0,	0,  0,	0,  0,	0,  0,
	0,  0,	0,  0,	0,  0,	0,  0,	0,  0,	0,  0,	0,  0,	0,  0,
};

uint8_t ut_bnr_lsc_lut[32] = {
	32, 32, 32, 32, 32, 32, 32, 33, 33, 34, 34, 35, 36, 37, 38, 39,
	40, 41, 43, 44, 45, 47, 49, 51, 53, 55, 57, 59, 61, 64, 66, 69,
};

uint16_t ut_manr_data[] = {
	264, 436, 264, 59, 262, 436, 266, 60, 260, 435, 268, 61, 258, 435, 270, 62,
	255, 434, 272, 63, 262, 436, 266, 60, 260, 435, 268, 61, 258, 435, 270, 62,
	264, 436, 264, 59, 262, 436, 266, 60, 260, 435, 268, 61, 258, 435, 270, 62,
	255, 434, 272, 63, 262, 436, 266, 60, 260, 435, 268, 61, 258, 435, 270, 62,
	264, 436, 264, 59, 262, 436, 266, 60, 260, 435, 268, 61, 258, 435, 270, 62,
	255, 434, 272, 63, 262, 436, 266, 60, 260, 435, 268, 61, 258, 435, 270, 62,
	264, 436, 264, 59, 262, 436, 266, 60, 260, 435, 268, 61, 258, 435, 270, 62,
	255, 434, 272, 63, 262, 436, 266, 60, 260, 435, 268, 61, 258, 435, 270, 62,
	264, 436, 264, 59, 262, 436, 266, 60, 260, 435, 268, 61, 258, 435, 270, 62,
	255, 434, 272, 63, 262, 436, 266, 60, 260, 435, 268, 61, 258, 435, 270, 62,
	264, 436, 264, 59, 262, 436, 266, 60, 260, 435, 268, 61, 258, 435, 270, 62,
	255, 434, 272, 63, 262, 436, 266, 60, 260, 435, 268, 61, 258, 435, 270, 62,
	264, 436, 264, 59, 262, 436, 266, 60, 260, 435, 268, 61, 258, 435, 270, 62,
	255, 434, 272, 63, 262, 436, 266, 60, 260, 435, 268, 61, 258, 435, 270, 62,
	264, 436, 264, 59, 262, 436, 266, 60, 260, 435, 268, 61, 258, 435, 270, 62,
	255, 434, 272, 63, 262, 436, 266, 60, 260, 435, 268, 61, 258, 435, 270, 62,
	138, 374, 374, 138,
};

uint8_t ut_cfa_ghp_lut[] = {
	0x8, 0x8, 0x8, 0x8,
	0xa, 0xa, 0xa, 0xa,
	0xc, 0xc, 0xc, 0xc,
	0xe, 0xe, 0xe, 0xe,
	0x10, 0x10, 0x10, 0x10,
	0x12, 0x12, 0x12, 0x12,
	0x14, 0x14, 0x14, 0x14,
	0x16, 0x16, 0x16, 0x16,
};

uint8_t ut_rgbee_ac_lut[] = {
	128, 128, 128, 128, 128, 128, 128, 128, 128, 128, 128, 128,
	128, 128, 128, 128, 128, 128, 128, 128, 128, 128, 128, 128,
	128, 128, 128, 128, 128, 128, 128, 128, 128,
};

uint8_t ut_rgbee_edge_lut[] = {
	16, 48, 48, 64, 64, 64, 64, 56, 48, 32, 32, 32,
	32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32,
	32, 32, 32, 32, 32, 32, 32, 32, 32,
};

uint8_t ut_rgbee_np_lut[] = {
	16, 16, 24, 32, 32, 32, 32, 32, 32, 32, 32, 32,
	32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32,
	32, 32, 32, 32, 32, 32, 32, 32, 32,
};

uint16_t ut_gamma_lut[] = {
	0, 120, 220, 310, 390, 470, 540, 610, 670, 730, 786, 842, 894, 944, 994, 1050, 1096, 1138, 1178,
	1218, 1254, 1280, 1314, 1346, 1378, 1408, 1438, 1467, 1493, 1519, 1543, 1568, 1592, 1615, 1638,
	1661, 1683, 1705, 1726, 1748, 1769, 1789, 1810, 1830, 1849, 1869, 1888, 1907, 1926, 1945, 1963,
	1981, 1999, 2017, 2034, 2052, 2069, 2086, 2102, 2119, 2136, 2152, 2168, 2184, 2200, 2216, 2231,
	2247, 2262, 2277, 2292, 2307, 2322, 2337, 2351, 2366, 2380, 2394, 2408, 2422, 2436, 2450, 2464,
	2477, 2491, 2504, 2518, 2531, 2544, 2557, 2570, 2583, 2596, 2609, 2621, 2634, 2646, 2659, 2671,
	2683, 2696, 2708, 2720, 2732, 2744, 2756, 2767, 2779, 2791, 2802, 2814, 2825, 2837, 2848, 2859,
	2871, 2882, 2893, 2904, 2915, 2926, 2937, 2948, 2959, 2969, 2980, 2991, 3001, 3012, 3023, 3033,
	3043, 3054, 3064, 3074, 3085, 3095, 3105, 3115, 3125, 3135, 3145, 3155, 3165, 3175, 3185, 3194,
	3204, 3214, 3224, 3233, 3243, 3252, 3262, 3271, 3281, 3290, 3300, 3309, 3318, 3327, 3337, 3346,
	3355, 3364, 3373, 3382, 3391, 3400, 3409, 3418, 3427, 3436, 3445, 3454, 3463, 3471, 3480, 3489,
	3498, 3506, 3515, 3523, 3532, 3540, 3549, 3557, 3566, 3574, 3583, 3591, 3600, 3608, 3616, 3624,
	3633, 3641, 3649, 3657, 3665, 3674, 3682, 3690, 3698, 3706, 3714, 3722, 3730, 3738, 3746, 3754,
	3762, 3769, 3777, 3785, 3793, 3801, 3808, 3816, 3824, 3832, 3839, 3847, 3855, 3862, 3870, 3877,
	3885, 3892, 3900, 3907, 3915, 3922, 3930, 3937, 3945, 3952, 3959, 3967, 3974, 3981, 3989, 3996,
	4003, 4010, 4018, 4025, 4032, 4039, 4046, 4054, 4061, 4068, 4075, 4082, 4089, 4095,
};


// depth = 8
uint8_t ut_ynr_intensity_sel[] = {
	22, 11, 8, 9, 14, 9, 31, 31
};
// depth =64
uint8_t ut_ynr_weight_lut[] = {
	31, 16, 8,  4,	2,  1,	1,  16,	16,  16, 8,  8, 8,  4,  4,  0,
	0,  0,	0,  0,	0,  0,	0,  0,	0,  0,	0,  0,	0,  0,	0,  0,
	0,  0,	0,  0,	0,  0,	0,  0,	0,  0,	0,  0,	0,  0,	0,  0,
	0,  0,	0,  0,	0,  0,	0,  0,	0,  0,	0,  0,	0,  0,	0,  0,
};
// depth = 6
uint8_t ut_ynr_ns0_luma_th[] = {
	22, 33, 55, 99, 139, 181,
};
// depth = 5
int16_t ut_ynr_ns0_slope[] = {
	279, 209, 81, -12, -121,
};
// depth = 6
uint8_t ut_ynr_ns0_offset[] = {
	25, 31, 40, 47, 46, 36
};
// depth = 6
uint8_t ut_ynr_ns1_luma_th[] = {
	22, 33, 55, 99, 139, 181,
};
// depth = 5
int16_t ut_ynr_ns1_slope[] = {
	93, 46, 23, 0, -36,
};
// depth = 6
uint8_t ut_ynr_ns1_offset[] = {
	7, 9, 11, 13, 13, 10
};

uint8_t ut_cnr_weight_lut[] = {
	16, 16, 8,  4,	2,  1,	1,  16,	16,  16, 8,  8, 8,  4,  4,  0,
};

uint8_t ut_cnr_intensity_sel[] = {
	16, 11, 8, 9, 14, 9, 3, 1,
};

uint8_t ut_dci_lut[] = {
	1,   2,   2,   3,   4,   5,   6,   7,   8,   9,   11,  12,  13,  14,  15,  16,
	17,  18,  19,  19,  20,  21,  22,  23,  24,  24,  25,  26,  27,  28,  28,  29,
	30,  30,  31,  32,  32,  33,  33,  34,  34,  35,  35,  36,  36,  37,  37,  37,
	38,  38,  38,  39,  39,  39,  40,  40,  40,  41,  41,  41,  43,  44,  46,  48,
	49,  51,  52,  54,  55,  57,  58,  60,  62,  63,  65,  66,  68,  70,  71,  73,
	75,  77,  78,  80,  82,  84,  85,  87,  89,  91,  93,  95,  96,  98,  100, 102,
	104, 106, 108, 110, 112, 114, 116, 118, 120, 122, 124, 126, 128, 130, 132, 134,
	136, 138, 140, 142, 144, 145, 147, 149, 151, 153, 155, 157, 159, 161, 163, 165,
	167, 169, 170, 172, 174, 176, 178, 179, 181, 183, 185, 187, 188, 190, 192, 193,
	195, 196, 198, 200, 201, 203, 204, 206, 207, 209, 210, 211, 213, 214, 215, 217,
	218, 219, 220, 222, 223, 224, 225, 226, 227, 228, 229, 230, 231, 232, 233, 234,
	235, 236, 236, 237, 238, 239, 239, 240, 241, 241, 242, 243, 243, 244, 244, 245,
	246, 246, 247, 247, 247, 248, 248, 249, 249, 249, 250, 250, 250, 251, 251, 251,
	252, 252, 252, 252, 252, 253, 253, 253, 253, 253, 253, 254, 254, 254, 254, 254,
	254, 254, 254, 254, 254, 254, 254, 254, 254, 254, 254, 254, 254, 254, 254, 254,
	254, 254, 254, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255,
};

uint8_t ut_luma_coring_lut[] = {
	0,    0,    0,    0,    4,    8,   12,   16,   20,   24,   28,   32,   32,   32,   32,   32,
	32,   32,   32,   32,   32,   32,  32,   32,   32,   32,   32,   32,   32,   32,   32,   32,
	32,
};

uint8_t ut_luma_adptctrl_lut[] = {
	0,    0,    0,    0,    4,    8,   12,   16,   20,   24,   28,   32,   32,   32,   32,   32,
	32,   32,   32,   32,   32,   32,  32,   32,   32,   32,   32,   32,   32,   32,   32,   32,
	32,
};

uint8_t ut_delta_adptctrl_lut[] = {
	0,    0,    0,    0,    4,    8,   12,   16,   20,   24,   28,   32,   32,   32,   32,   32,
	32,   32,   32,   32,   32,   32,  32,   32,   32,   32,   32,   32,   32,   32,   32,   32,
	32,
};

uint8_t ut_luma_shtctrl_lut[] = {
	0,    0,    0,    0,    4,    8,   12,   16,   20,   24,   28,   32,   32,   32,   32,   32,
	32,   32,   32,   32,   32,   32,  32,   32,   32,   32,   32,   32,   32,   32,   32,   32,
	32,
};

uint8_t ut_delta_shtctrl_lut[] = {
	0,    0,    0,    0,    4,    8,   12,   16,   20,   24,   28,   32,   32,   32,   32,   32,
	32,   32,   32,   32,   32,   32,  32,   32,   32,   32,   32,   32,   32,   32,   32,   32,
	32,
};

uint16_t ut_C_lut[] = {
	1,   2,   2,   3,   4,	 5,   6,   7,	8,   9,   11,  12,  13,  14,  15,  16,
	17,  18,  19,  19,  20,  21,  22,  23,	24,  24,  25,  26,  27,  28,  28,  29,
	30,  30,  31,  32,  32,  33,  33,  34,	34,  35,  35,  36,  36,  37,  37,  37,
	38,  38,  38,  39,  39,  39,  40,  40,	40,  41,  41,  41,  43,  44,  46,  48,
	49,  51,  52,  54,  55,  57,  58,  60,	62,  63,  65,  66,  68,  70,  71,  73,
	75,  77,  78,  80,  82,  84,  85,  87,	89,  91,  93,  95,  96,  98,  100, 102,
	104, 106, 108, 110, 112, 114, 116, 118, 120, 122, 124, 126, 128, 130, 132, 134,
	136, 138, 140, 142, 144, 145, 147, 149, 151, 153, 155, 157, 159, 161, 163, 165,
	167, 169, 170, 172, 174, 176, 178, 179, 181, 183, 185, 187, 188, 190, 192, 193,
	195, 196, 198, 200, 201, 203, 204, 206, 207, 209, 210, 211, 213, 214, 215, 217,
	218, 219, 220, 222, 223, 224, 225, 226, 227, 228, 229, 230, 231, 232, 233, 234,
	235, 236, 236, 237, 238, 239, 239, 240, 241, 241, 242, 243, 243, 244, 244, 245,
	246, 246, 247, 247, 247, 248, 248, 249, 249, 249, 250, 250, 250, 251, 251, 251,
	252, 252, 252, 252, 252, 253, 253, 253, 253, 253, 253, 254, 254, 254, 254, 254,
	254, 254, 254, 254, 254, 254, 254, 254, 254, 254, 254, 254, 254, 254, 254, 254,
	254, 254, 254, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255,
	1,   2,   2,   3,   4,	 5,   6,   7,	8,   9,   11,  12,  13,  14,  15,  16,
	17,  18,  19,  19,  20,  21,  22,  23,	24,  24,  25,  26,  27,  28,  28,  29,
	30,  30,  31,  32,  32,  33,  33,  34,	34,  35,  35,  36,  36,  37,  37,  37,
	38,  38,  38,  39,  39,  39,  40,  40,	40,  41,  41,  41,  43,  44,  46,  48,
	49,  51,  52,  54,  55,  57,  58,  60,	62,  63,  65,  66,  68,  70,  71,  73,
	75,  77,  78,  80,  82,  84,  85,  87,	89,  91,  93,  95,  96,  98,  100, 102,
	104, 106, 108, 110, 112, 114, 116, 118, 120, 122, 124, 126, 128, 130, 132, 134,
	136, 138, 140, 142, 144, 145, 147, 149, 151, 153, 155, 157, 159, 161, 163, 165,
	167, 169, 170, 172, 174, 176, 178, 179, 181, 183, 185, 187, 188, 190, 192, 193,
	195, 196, 198, 200, 201, 203, 204, 206, 207, 209, 210, 211, 213, 214, 215, 217,
	218, 219, 220, 222, 223, 224, 225, 226, 227, 228, 229, 230, 231, 232, 233, 234,
	235, 236, 236, 237, 238, 239, 239, 240, 241, 241, 242, 243, 243, 244, 244, 245,
	246, 246, 247, 247, 247, 248, 248, 249, 249, 249, 250, 250, 250, 251, 251, 251,
	252, 252, 252, 252, 252, 253, 253, 253, 253, 253, 253, 254, 254, 254, 254, 254,
	254, 254, 254, 254, 254, 254, 254, 254, 254, 254, 254, 254, 254, 254, 254, 254,
	254, 254, 254, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255,
	1,   2,   2,   3,   4,	 5,   6,   7,	8,   9,   11,  12,  13,  14,  15,  16,
	17,  18,  19,  19,  20,  21,  22,  23,	24,  24,  25,  26,  27,  28,  28,  29,
	30,  30,  31,  32,  32,  33,  33,  34,	34,  35,  35,  36,  36,  37,  37,  37,
	38,  38,  38,  39,  39,  39,  40,  40,	40,  41,  41,  41,  43,  44,  46,  48,
	49,  51,  52,  54,  55,  57,  58,  60,	62,  63,  65,  66,  68,  70,  71,  73,
	75,  77,  78,  80,  82,  84,  85,  87,	89,  91,  93,  95,  96,  98,  100, 102,
	104, 106, 108, 110, 112, 114, 116, 118, 120, 122, 124, 126, 128, 130, 132, 134,
	136, 138, 140, 142, 144, 145, 147, 149, 151, 153, 155, 157, 159, 161, 163, 165,
	167, 169, 170, 172, 174, 176, 178, 179, 181, 183, 185, 187, 188, 190, 192, 193,
	195, 196, 198, 200, 201, 203, 204, 206, 207, 209, 210, 211, 213, 214, 215, 217,
	218, 219, 220, 222, 223, 224, 225, 226, 227, 228, 229, 230, 231, 232, 233, 234,
	235, 236, 236, 237, 238, 239, 239, 240, 241, 241, 242, 243, 243, 244, 244, 245,
	246, 246, 247, 247, 247, 248, 248, 249, 249, 249, 250, 250, 250, 251, 251, 251,
	252, 252, 252, 252, 252, 253, 253, 253, 253, 253, 253, 254, 254, 254, 254, 254,
	254, 254, 254, 254, 254, 254, 254, 254, 254, 254, 254, 254, 254, 254, 254, 254,
	254, 254, 254, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255,
	1,   2,   2,   3,   4,	 5,   6,   7,	8,   9,   11,  12,  13,  14,  15,  16,
	17,  18,  19,  19,  20,  21,  22,  23,	24,  24,  25,  26,  27,  28,  28,  29,
	30,  30,  31,  32,  32,  33,  33,  34,	34,  35,  35,  36,  36,  37,  37,  37,
	38,  38,  38,  39,  39,  39,  40,  40,	40,  41,  41,  41,  43,  44,  46,  48,
	49,  51,  52,  54,  55,  57,  58,  60,	62,  63,  65,  66,  68,  70,  71,  73,
	75,  77,  78,  80,  82,  84,  85,  87,	89,  91,  93,  95,  96,  98,  100, 102,
	104, 106, 108, 110, 112, 114, 116, 118, 120, 122, 124, 126, 128, 130, 132, 134,
	136, 138, 140, 142, 144, 145, 147, 149, 151, 153, 155, 157, 159, 161, 163, 165,
	167, 169, 170, 172, 174, 176, 178, 179, 181, 183, 185, 187, 188, 190, 192, 193,
	195, 196, 198, 200, 201, 203, 204, 206, 207, 209, 210, 211, 213, 214, 215, 217,
	218, 219, 220, 222, 223, 224, 225, 226, 227, 228, 229, 230, 231, 232, 233, 234,
	235, 236, 236, 237, 238, 239, 239, 240, 241, 241, 242, 243, 243, 244, 244, 245,
	246, 246, 247, 247, 247, 248, 248, 249, 249, 249, 250, 250, 250, 251, 251, 251,
	252, 252, 252, 252, 252, 253, 253, 253, 253, 253, 253, 254, 254, 254, 254, 254,
	254, 254, 254, 254, 254, 254, 254, 254, 254, 254, 254, 254, 254, 254, 254, 254,
	254, 254, 254, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255,
	1,   2,   2,   3,   4,	 5,   6,   7,	8,   9,   11,  12,  13,  14,  15,  16,
	17,  18,  19,  19,  20,  21,  22,  23,	24,  24,  25,  26,  27,  28,  28,  29,
	30,  30,  31,  32,  32,  33,  33,  34,	34,  35,  35,  36,  36,  37,  37,  37,
	38,  38,  38,  39,  39,  39,  40,  40,	40,  41,  41,  41,  43,  44,  46,  48,
	49,  51,  52,  54,  55,  57,  58,  60,	62,  63,  65,  66,  68,  70,  71,  73,
	75,  77,  78,  80,  82,  84,  85,  87,	89,  91,  93,  95,  96,  98,  100, 102,
	104, 106, 108, 110, 112, 114, 116, 118, 120, 122, 124, 126, 128, 130, 132, 134,
	136, 138, 140, 142, 144, 145, 147, 149, 151, 153, 155, 157, 159, 161, 163, 165,
	167, 169, 170, 172, 174, 176, 178, 179, 181, 183, 185, 187, 188, 190, 192, 193,
	195, 196, 198, 200, 201, 203, 204, 206, 207, 209, 210, 211, 213, 214, 215, 217,
	218, 219, 220, 222, 223, 224, 225, 226, 227, 228, 229, 230, 231, 232, 233, 234,
	235, 236, 236, 237, 238, 239, 239, 240, 241, 241, 242, 243, 243, 244, 244, 245,
	246, 246, 247, 247, 247, 248, 248, 249, 249, 249, 250, 250, 250, 251, 251, 251,
	252, 252, 252, 252, 252, 253, 253, 253, 253, 253, 253, 254, 254, 254, 254, 254,
	254, 254, 254, 254, 254, 254, 254, 254, 254, 254, 254, 254, 254, 254, 254, 254,
	254, 254, 254, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255,
	1,   2,   2,   3,   4,	 5,   6,   7,	8,   9,   11,  12,  13,  14,  15,  16,
	17,  18,  19,  19,  20,  21,  22,  23,	24,  24,  25,  26,  27,  28,  28,  29,
	30,  30,  31,  32,  32,  33,  33,  34,	34,  35,  35,  36,  36,  37,  37,  37,
	38,  38,  38,  39,  39,  39,  40,  40,	40,  41,  41,  41,  43,  44,  46,  48,
	49,  51,  52,  54,  55,  57,  58,  60,	62,  63,  65,  66,  68,  70,  71,  73,
	75,  77,  78,  80,  82,  84,  85,  87,	89,  91,  93,  95,  96,  98,  100, 102,
	104, 106, 108, 110, 112, 114, 116, 118, 120, 122, 124, 126, 128, 130, 132, 134,
	136, 138, 140, 142, 144, 145, 147, 149, 151, 153, 155, 157, 159, 161, 163, 165,
	167, 169, 170, 172, 174, 176, 178, 179, 181, 183, 185, 187, 188, 190, 192, 193,
	195, 196, 198, 200, 201, 203, 204, 206, 207, 209, 210, 211, 213, 214, 215, 217,
	218, 219, 220, 222, 223, 224, 225, 226, 227, 228, 229, 230, 231, 232, 233, 234,
	235, 236, 236, 237, 238, 239, 239, 240, 241, 241, 242, 243, 243, 244, 244, 245,
	246, 246, 247, 247, 247, 248, 248, 249, 249, 249, 250, 250, 250, 251, 251, 251,
	252, 252, 252, 252, 252, 253, 253, 253, 253, 253, 253, 254, 254, 254, 254, 254,
	254, 254, 254, 254, 254, 254, 254, 254, 254, 254, 254, 254, 254, 254, 254, 254,
	254, 254, 254, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255,
	1,   2,   2,   3,   4,	 5,   6,   7,	8,   9,   11,  12,  13,  14,  15,  16,
	17,  18,  19,  19,  20,  21,  22,  23,	24,  24,  25,  26,  27,  28,  28,  29,
	30,  30,  31,  32,  32,  33,  33,  34,	34,  35,  35,  36,  36,  37,  37,  37,
	38,  38,  38,  39,  39,  39,  40,  40,	40,  41,  41,  41,  43,  44,  46,  48,
	49,  51,  52,  54,  55,  57,  58,  60,	62,  63,  65,  66,  68,  70,  71,  73,
	75,  77,  78,  80,  82,  84,  85,  87,	89,  91,  93,  95,  96,  98,  100, 102,
	104, 106, 108, 110, 112, 114, 116, 118, 120, 122, 124, 126, 128, 130, 132, 134,
	136, 138, 140, 142, 144, 145, 147, 149, 151, 153, 155, 157, 159, 161, 163, 165,
	167, 169, 170, 172, 174, 176, 178, 179, 181, 183, 185, 187, 188, 190, 192, 193,
	195, 196, 198, 200, 201, 203, 204, 206, 207, 209, 210, 211, 213, 214, 215, 217,
	218, 219, 220, 222, 223, 224, 225, 226, 227, 228, 229, 230, 231, 232, 233, 234,
	235, 236, 236, 237, 238, 239, 239, 240, 241, 241, 242, 243, 243, 244, 244, 245,
	246, 246, 247, 247, 247, 248, 248, 249, 249, 249, 250, 250, 250, 251, 251, 251,
	252, 252, 252, 252, 252, 253, 253, 253, 253, 253, 253, 254, 254, 254, 254, 254,
	254, 254, 254, 254, 254, 254, 254, 254, 254, 254, 254, 254, 254, 254, 254, 254,
	254, 254, 254, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255,
	1,   2,   2,   3,   4,	 5,   6,   7,	8,   9,   11,  12,  13,  14,  15,  16,
	17,  18,  19,  19,  20,  21,  22,  23,	24,  24,  25,  26,  27,  28,  28,  29,
	30,  30,  31,  32,  32,  33,  33,  34,	34,  35,  35,  36,  36,  37,  37,  37,
	38,  38,  38,  39,  39,  39,  40,  40,	40,  41,  41,  41,  43,  44,  46,  48,
	49,  51,  52,  54,  55,  57,  58,  60,	62,  63,  65,  66,  68,  70,  71,  73,
	75,  77,  78,  80,  82,  84,  85,  87,	89,  91,  93,  95,  96,  98,  100, 102,
	104, 106, 108, 110, 112, 114, 116, 118, 120, 122, 124, 126, 128, 130, 132, 134,
	136, 138, 140, 142, 144, 145, 147, 149, 151, 153, 155, 157, 159, 161, 163, 165,
	167, 169, 170, 172, 174, 176, 178, 179, 181, 183, 185, 187, 188, 190, 192, 193,
	195, 196, 198, 200, 201, 203, 204, 206, 207, 209, 210, 211, 213, 214, 215, 217,
	218, 219, 220, 222, 223, 224, 225, 226, 227, 228, 229, 230, 231, 232, 233, 234,
	235, 236, 236, 237, 238, 239, 239, 240, 241, 241, 242, 243, 243, 244, 244, 245,
	246, 246, 247, 247, 247, 248, 248, 249, 249, 249, 250, 250, 250, 251, 251, 251,
	252, 252, 252, 252, 252, 253, 253, 253, 253, 253, 253, 254, 254, 254, 254, 254,
	254, 254, 254, 254, 254, 254, 254, 254, 254, 254, 254, 254, 254, 254, 254, 254,
	254, 254, 254, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255,
	1,   2,   2,   3,   4,	 5,   6,   7,	8,   9,   11,  12,  13,  14,  15,  16,
	17,  18,  19,  19,  20,  21,  22,  23,	24,  24,  25,  26,  27,  28,  28,  29,
	30,  30,  31,  32,  32,  33,  33,  34,	34,  35,  35,  36,  36,  37,  37,  37,
	38,  38,  38,  39,  39,  39,  40,  40,	40,  41,  41,  41,  43,  44,  46,  48,
	49,  51,  52,  54,  55,  57,  58,  60,	62,  63,  65,  66,  68,  70,  71,  73,
	75,  77,  78,  80,  82,  84,  85,  87,	89,  91,  93,  95,  96,  98,  100, 102,
	104, 106, 108, 110, 112, 114, 116, 118, 120, 122, 124, 126, 128, 130, 132, 134,
	136, 138, 140, 142, 144, 145, 147, 149, 151, 153, 155, 157, 159, 161, 163, 165,
	167, 169, 170, 172, 174, 176, 178, 179, 181, 183, 185, 187, 188, 190, 192, 193,
	195, 196, 198, 200, 201, 203, 204, 206, 207, 209, 210, 211, 213, 214, 215, 217,
	218, 219, 220, 222, 223, 224, 225, 226, 227, 228, 229, 230, 231, 232, 233, 234,
	235, 236, 236, 237, 238, 239, 239, 240, 241, 241, 242, 243, 243, 244, 244, 245,
	246, 246, 247, 247, 247, 248, 248, 249, 249, 249, 250, 250, 250, 251, 251, 251,
	252, 252, 252, 252, 252, 253, 253, 253, 253, 253, 253, 254, 254, 254, 254, 254,
	254, 254, 254, 254, 254, 254, 254, 254, 254, 254, 254, 254, 254, 254, 254, 254,
	254, 254, 254, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255,
	1,   2,   2,   3,   4,	 5,   6,   7,	8,   9,   11,  12,  13,  14,  15,  16,
	17,  18,  19,  19,  20,  21,  22,  23,	24,  24,  25,  26,  27,  28,  28,  29,
	30,  30,  31,  32,  32,  33,  33,  34,	34,  35,  35,  36,  36,  37,  37,  37,
	38,  38,  38,  39,  39,  39,  40,  40,	40,  41,  41,  41,  43,  44,  46,  48,
	49,  51,  52,  54,  55,  57,  58,  60,	62,  63,  65,  66,  68,  70,  71,  73,
	75,  77,  78,  80,  82,  84,  85,  87,	89,  91,  93,  95,  96,  98,  100, 102,
	104, 106, 108, 110, 112, 114, 116, 118, 120, 122, 124, 126, 128, 130, 132, 134,
	136, 138, 140, 142, 144, 145, 147, 149, 151, 153, 155, 157, 159, 161, 163, 165,
	167, 169, 170, 172, 174, 176, 178, 179, 181, 183, 185, 187, 188, 190, 192, 193,
	195, 196, 198, 200, 201, 203, 204, 206, 207, 209, 210, 211, 213, 214, 215, 217,
	218, 219, 220, 222, 223, 224, 225, 226, 227, 228, 229, 230, 231, 232, 233, 234,
	235, 236, 236, 237, 238, 239, 239, 240, 241, 241, 242, 243, 243, 244, 244, 245,
	246, 246, 247, 247, 247, 248, 248, 249, 249, 249, 250, 250, 250, 251, 251, 251,
	252, 252, 252, 252, 252, 253, 253, 253, 253, 253, 253, 254, 254, 254, 254, 254,
	254, 254, 254, 254, 254, 254, 254, 254, 254, 254, 254, 254, 254, 254, 254, 254,
	254, 254, 254, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255,
	1,   2,   2,   3,   4,	 5,   6,   7,	8,   9,   11,  12,  13,  14,  15,  16,
	17,  18,  19,  19,  20,  21,  22,  23,	24,  24,  25,  26,  27,  28,  28,  29,
	30,  30,  31,  32,  32,  33,  33,  34,	34,  35,  35,  36,  36,  37,  37,  37,
	38,  38,  38,  39,  39,  39,  40,  40,	40,  41,  41,  41,  43,  44,  46,  48,
	49,  51,  52,  54,  55,  57,  58,  60,	62,  63,  65,  66,  68,  70,  71,  73,
	75,  77,  78,  80,  82,  84,  85,  87,	89,  91,  93,  95,  96,  98,  100, 102,
	104, 106, 108, 110, 112, 114, 116, 118, 120, 122, 124, 126, 128, 130, 132, 134,
	136, 138, 140, 142, 144, 145, 147, 149, 151, 153, 155, 157, 159, 161, 163, 165,
	167, 169, 170, 172, 174, 176, 178, 179, 181, 183, 185, 187, 188, 190, 192, 193,
	195, 196, 198, 200, 201, 203, 204, 206, 207, 209, 210, 211, 213, 214, 215, 217,
	218, 219, 220, 222, 223, 224, 225, 226, 227, 228, 229, 230, 231, 232, 233, 234,
	235, 236, 236, 237, 238, 239, 239, 240, 241, 241, 242, 243, 243, 244, 244, 245,
	246, 246, 247, 247, 247, 248, 248, 249, 249, 249, 250, 250, 250, 251, 251, 251,
	252, 252, 252, 252, 252, 253, 253, 253, 253, 253, 253, 254, 254, 254, 254, 254,
	254, 254, 254, 254, 254, 254, 254, 254, 254, 254, 254, 254, 254, 254, 254, 254,
	254, 254, 254, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255,
	1,   2,   2,   3,   4,	 5,   6,   7,	8,   9,   11,  12,  13,  14,  15,  16,
	17,  18,  19,  19,  20,  21,  22,  23,	24,  24,  25,  26,  27,  28,  28,  29,
	30,  30,  31,  32,  32,  33,  33,  34,	34,  35,  35,  36,  36,  37,  37,  37,
	38,  38,  38,  39,  39,  39,  40,  40,	40,  41,  41,  41,  43,  44,  46,  48,
	49,  51,  52,  54,  55,  57,  58,  60,	62,  63,  65,  66,  68,  70,  71,  73,
	75,  77,  78,  80,  82,  84,  85,  87,	89,  91,  93,  95,  96,  98,  100, 102,
	104, 106, 108, 110, 112, 114, 116, 118, 120, 122, 124, 126, 128, 130, 132, 134,
	136, 138, 140, 142, 144, 145, 147, 149, 151, 153, 155, 157, 159, 161, 163, 165,
	167, 169, 170, 172, 174, 176, 178, 179, 181, 183, 185, 187, 188, 190, 192, 193,
	195, 196, 198, 200, 201, 203, 204, 206, 207, 209, 210, 211, 213, 214, 215, 217,
	218, 219, 220, 222, 223, 224, 225, 226, 227, 228, 229, 230, 231, 232, 233, 234,
	235, 236, 236, 237, 238, 239, 239, 240, 241, 241, 242, 243, 243, 244, 244, 245,
	246, 246, 247, 247, 247, 248, 248, 249, 249, 249, 250, 250, 250, 251, 251, 251,
	252, 252, 252, 252, 252, 253, 253, 253, 253, 253, 253, 254, 254, 254, 254, 254,
	254, 254, 254, 254, 254, 254, 254, 254, 254, 254, 254, 254, 254, 254, 254, 254,
	254, 254, 254, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255,
	1,   2,   2,   3,   4,	 5,   6,   7,	8,   9,   11,  12,  13,  14,  15,  16,
	17,  18,  19,  19,  20,  21,  22,  23,	24,  24,  25,  26,  27,  28,  28,  29,
	30,  30,  31,  32,  32,  33,  33,  34,	34,  35,  35,  36,  36,  37,  37,  37,
	38,  38,  38,  39,  39,  39,  40,  40,	40,  41,  41,  41,  43,  44,  46,  48,
	49,  51,  52,  54,  55,  57,  58,  60,	62,  63,  65,  66,  68,  70,  71,  73,
	75,  77,  78,  80,  82,  84,  85,  87,	89,  91,  93,  95,  96,  98,  100, 102,
	104, 106, 108, 110, 112, 114, 116, 118, 120, 122, 124, 126, 128, 130, 132, 134,
	136, 138, 140, 142, 144, 145, 147, 149, 151, 153, 155, 157, 159, 161, 163, 165,
	167, 169, 170, 172, 174, 176, 178, 179, 181, 183, 185, 187, 188, 190, 192, 193,
	195, 196, 198, 200, 201, 203, 204, 206, 207, 209, 210, 211, 213, 214, 215, 217,
	218, 219, 220, 222, 223, 224, 225, 226, 227, 228, 229, 230, 231, 232, 233, 234,
	235, 236, 236, 237, 238, 239, 239, 240, 241, 241, 242, 243, 243, 244, 244, 245,
	235, 236, 236, 237, 238, 239, 239, 240, 241, 241, 242, 243, 243, 244, 244, 245,
};

uint16_t ut_lscr_gain_lut[] = {
	512,   521,  541,  570,  620,  688,  767,  866,
	985,  1147, 1340, 1551, 1802, 2102, 2463, 2842,
	3304, 3886, 4095, 4095, 4095, 4095, 4095, 4095,
	4095, 4095, 4095, 4095, 4095, 4095, 4095, 4095,
};

uint32_t isp_bp_tbl[] = {
	8, 16, 32, 64, 128, 256, 512, 1024
};

uint8_t ltm_lp_dist_wgt[] = {
	31, 20, 12, 8, 6, 4, 2, 1, 1, 1, 1,
};

uint8_t ltm_lp_diff_wgt[] = {
	16, 16, 15, 14, 10,  6, 5, 4, 3, 2, 1, 1, 1, 1, 1, 1,
	1,  1,	1,  1,	1,  1, 1, 1, 1, 1, 1, 1, 1, 1,
};

uint8_t ltm_be_dist_wgt[] = {
	31, 20, 12,  8,  6,  4,  2,  1,  1,  1,  1,
};

uint8_t ltm_de_dist_wgt[] = {
	32, 20, 12,  8,  6,  4,  2,  1,  1,  1,  1,
};

uint8_t ltm_de_luma_wgt[] = {
	4,  4,	4,  4,	3,  3,	3,  3,	3,  2,	2,  2,	2,  1,	1,  1,
	1,  1,	1,  1,	1,  1,	1,  1,	1,  1,	1,  1,	1,  1,
};

uint16_t ltm_d_lut[] = {
0,    172,  317,  422,  489,  538,  581,  622,  661,  697,  731,  764,  795,
826,  854,  881,  907,  932,  957,  980,  1004, 1027, 1050, 1072, 1093, 1112,
1129, 1146, 1163, 1180, 1197, 1214, 1230, 1247, 1263, 1279, 1295, 1311, 1327,
1343, 1358, 1373, 1389, 1404, 1419, 1433, 1448, 1463, 1477, 1492, 1506, 1520,
1534, 1548, 1561, 1575, 1589, 1602, 1615, 1628, 1641, 1654, 1667, 1680, 1693,
1705, 1718, 1730, 1742, 1754, 1766, 1778, 1790, 1802, 1813, 1825, 1836, 1848,
1859, 1870, 1881, 1892, 1903, 1914, 1925, 1936, 1946, 1957, 1967, 1977, 1988,
1998, 2008, 2018, 2028, 2038, 2048, 2058, 2067, 2077, 2087, 2096, 2106, 2115,
2125, 2134, 2144, 2153, 2163, 2173, 2182, 2192, 2202, 2211, 2221, 2230, 2240,
2250, 2259, 2269, 2278, 2288, 2298, 2307, 2317, 2326, 2336, 2345, 2355, 2364,
2374, 2383, 2393, 2402, 2412, 2421, 2431, 2440, 2449, 2459, 2468, 2478, 2487,
2496, 2505, 2515, 2524, 2533, 2542, 2551, 2560, 2569, 2578, 2587, 2596, 2605,
2614, 2623, 2632, 2641, 2650, 2658, 2667, 2676, 2684, 2693, 2701, 2710, 2718,
2727, 2735, 2743, 2752, 2760, 2768, 2776, 2784, 2792, 2800, 2808, 2816, 2824,
2832, 2839, 2847, 2854, 2862, 2870, 2877, 2884, 2892, 2899, 2906, 2913, 2920,
2927, 2934, 2941, 2948, 2954, 2961, 2968, 2974, 2981, 2987, 2993, 3000, 3006,
3012, 3018, 3024, 3030, 3035, 3041, 3047, 3052, 3058, 3063, 3068, 3073, 3079,
3084, 3088, 3093, 3098, 3103, 3107, 3112, 3116, 3121, 3125, 3129, 3133, 3137,
3141, 3145, 3148, 3152, 3155, 3159, 3162, 3165, 3168, 3171, 3174, 3177, 3179,
3182, 3184, 3186, 3189, 3191, 3193, 3195, 3196, 3198, 4001,
};

uint16_t ltm_b_lut[] = {
0,    115,  230,  346,  458,  575,  694,  813,  927,  1033, 1129, 1211, 1275,
1321, 1363, 1402, 1438, 1473, 1505, 1536, 1565, 1592, 1617, 1641, 1663, 1684,
1703, 1722, 1739, 1755, 1771, 1786, 1800, 1813, 1827, 1840, 1853, 1866, 1879,
1891, 1904, 1916, 1928, 1940, 1951, 1963, 1974, 1986, 1997, 2007, 2018, 2029,
2039, 2049, 2059, 2069, 2079, 2089, 2098, 2108, 2117, 2126, 2135, 2144, 2153,
2162, 2170, 2178, 2187, 2195, 2203, 2211, 2219, 2227, 2234, 2242, 2249, 2257,
2264, 2271, 2278, 2285, 2292, 2299, 2306, 2312, 2319, 2326, 2332, 2339, 2345,
2351, 2357, 2364, 2370, 2376, 2382, 2388, 2394, 2400, 2405, 2411, 2417, 2423,
2429, 2434, 2440, 2445, 2451, 2457, 2462, 2468, 2473, 2479, 2484, 2490, 2495,
2501, 2507, 2512, 2518, 2523, 2529, 2534, 2540, 2545, 2551, 2557, 2562, 2568,
2573, 2579, 2584, 2589, 2595, 2600, 2605, 2610, 2616, 2621, 2626, 2631, 2636,
2641, 2646, 2651, 2656, 2661, 2665, 2670, 2675, 2680, 2685, 2689, 2694, 2699,
2703, 2708, 2712, 2717, 2721, 2726, 2730, 2735, 2739, 2743, 2748, 2752, 2756,
2761, 2765, 2769, 2773, 2778, 2782, 2786, 2790, 2794, 2798, 2802, 2807, 2811,
2815, 2819, 2823, 2827, 2831, 2835, 2839, 2843, 2846, 2850, 2854, 2858, 2862,
2866, 2870, 2874, 2877, 2881, 2885, 2889, 2893, 2897, 2900, 2904, 2908, 2912,
2915, 2919, 2923, 2927, 2931, 2934, 2938, 2942, 2946, 2949, 2953, 2957, 2961,
2964, 2968, 2972, 2976, 2979, 2983, 2987, 2991, 2994, 2998, 3002, 3006, 3010,
3013, 3017, 3021, 3025, 3029, 3032, 3036, 3040, 3044, 3048, 3052, 3056, 3060,
3064, 3067, 3071, 3075, 3079, 3083, 3087, 3091, 3095, 3100, 3104, 3108, 3112,
3116, 3120, 3124, 3128, 3132, 3136, 3140, 3144, 3148, 3152, 3156, 3160, 3164,
3168, 3173, 3177, 3181, 3185, 3189, 3193, 3197, 3201, 3205, 3209, 3213, 3217,
3221, 3225, 3229, 3233, 3237, 3241, 3245, 3249, 3253, 3257, 3261, 3265, 3269,
3273, 3277, 3281, 3285, 3289, 3293, 3297, 3301, 3305, 3309, 3313, 3317, 3321,
3325, 3329, 3333, 3337, 3341, 3345, 3349, 3353, 3357, 3361, 3365, 3369, 3373,
3377, 3381, 3385, 3389, 3393, 3397, 3401, 3405, 3409, 3413, 3417, 3421, 3425,
3429, 3433, 3437, 3441, 3445, 3449, 3453, 3457, 3461, 3465, 3469, 3472, 3476,
3480, 3484, 3488, 3492, 3496, 3500, 3504, 3508, 3512, 3516, 3520, 3524, 3528,
3532, 3536, 3539, 3543, 3547, 3551, 3555, 3559, 3563, 3567, 3571, 3575, 3579,
3583, 3586, 3590, 3594, 3598, 3602, 3606, 3610, 3614, 3618, 3622, 3625, 3629,
3633, 3637, 3641, 3645, 3649, 3653, 3657, 3660, 3664, 3668, 3672, 3676, 3680,
3684, 3687, 3691, 3695, 3699, 3703, 3707, 3711, 3714, 3718, 3722, 3726, 3730,
3734, 3738, 3741, 3745, 3749, 3753, 3757, 3761, 3764, 3768, 3772, 3776, 3780,
3784, 3787, 3791, 3795, 3799, 3803, 3806, 3810, 3814, 3818, 3822, 3826, 3829,
3833, 3837, 3841, 3845, 3848, 3852, 3856, 3860, 3863, 3867, 3871, 3875, 3879,
3882, 3886, 3890, 3894, 3897, 3901, 3905, 3909, 3913, 3916, 3920, 3924, 3928,
3931, 3935, 3939, 3943, 3946, 3950, 3954, 3958, 3961, 3965, 3969, 3972, 3976,
3980, 3984, 3987, 3991, 3995, 3999, 4002, 4006, 4010, 4013, 4017, 4021, 4025,
4028, 4032, 4036, 4039, 4043, 4047, 4050, 4054, 4058, 4061, 4065, 4069, 4073,
4076, 4080, 4084, 4087, 4091, 4095,
};

uint16_t ltm_g_lut[] = {
0,    48,   96,   142,  187,  231,  273,  313,  352,  389,  425,  458,  490,
520,  549,  577,  605,  632,  659,  686,  714,  741,  769,  796,  824,  851,
878,  905,  932,  959,  986,  1013, 1039, 1066, 1092, 1118, 1144, 1170, 1196,
1222, 1247, 1272, 1297, 1322, 1347, 1371, 1395, 1420, 1443, 1467, 1490, 1513,
1536, 1558, 1581, 1603, 1625, 1647, 1668, 1690, 1711, 1732, 1754, 1775, 1796,
1817, 1839, 1860, 1880, 1901, 1922, 1942, 1962, 1982, 2001, 2020, 2039, 2057,
2075, 2092, 2110, 2126, 2142, 2158, 2174, 2190, 2205, 2220, 2234, 2249, 2263,
2277, 2290, 2304, 2317, 2330, 2342, 2355, 2367, 2380, 2392, 2405, 2417, 2429,
2441, 2453, 2465, 2477, 2489, 2500, 2511, 2522, 2533, 2544, 2555, 2565, 2575,
2585, 2595, 2605, 2614, 2623, 2632, 2641, 2649, 2658, 2665, 2673, 2681, 2688,
2695, 2703, 2709, 2716, 2723, 2729, 2736, 2742, 2748, 2754, 2759, 2765, 2770,
2776, 2781, 2786, 2791, 2796, 2801, 2806, 2811, 2816, 2821, 2826, 2831, 2836,
2841, 2846, 2851, 2856, 2861, 2866, 2871, 2876, 2881, 2885, 2890, 2895, 2900,
2905, 2910, 2914, 2919, 2924, 2928, 2933, 2938, 2942, 2947, 2952, 2956, 2961,
2965, 2970, 2974, 2979, 2983, 2988, 2992, 2996, 3001, 3005, 3009, 3013, 3018,
3022, 3026, 3030, 3034, 3038, 3042, 3046, 3050, 3054, 3058, 3062, 3066, 3069,
3073, 3077, 3080, 3084, 3088, 3091, 3095, 3098, 3102, 3105, 3108, 3112, 3115,
3118, 3121, 3124, 3127, 3130, 3133, 3136, 3139, 3142, 3145, 3148, 3150, 3153,
3156, 3158, 3161, 3163, 3166, 3168, 3170, 3173, 3175, 3177, 3179, 3181, 3183,
3185, 3187, 3189, 3190, 3192, 3194, 3195, 3197, 3198, 3200, 3210, 3221, 3232,
3242, 3252, 3262, 3272, 3282, 3291, 3300, 3310, 3319, 3327, 3336, 3345, 3353,
3361, 3369, 3377, 3385, 3393, 3400, 3408, 3415, 3422, 3429, 3436, 3443, 3450,
3456, 3462, 3469, 3475, 3481, 3487, 3493, 3498, 3504, 3509, 3515, 3520, 3525,
3530, 3535, 3540, 3545, 3549, 3554, 3559, 3563, 3567, 3572, 3576, 3580, 3584,
3588, 3592, 3595, 3599, 3603, 3606, 3610, 3613, 3617, 3620, 3624, 3627, 3630,
3633, 3636, 3639, 3642, 3645, 3648, 3651, 3654, 3656, 3659, 3662, 3665, 3667,
3670, 3673, 3675, 3678, 3680, 3683, 3685, 3688, 3690, 3693, 3695, 3698, 3700,
3703, 3705, 3707, 3710, 3712, 3715, 3717, 3719, 3721, 3724, 3726, 3728, 3730,
3733, 3735, 3737, 3739, 3741, 3743, 3745, 3747, 3749, 3751, 3753, 3755, 3757,
3759, 3761, 3763, 3765, 3767, 3769, 3771, 3772, 3774, 3776, 3778, 3780, 3781,
3783, 3785, 3787, 3788, 3790, 3792, 3793, 3795, 3797, 3798, 3800, 3801, 3803,
3805, 3806, 3808, 3809, 3811, 3812, 3814, 3815, 3817, 3818, 3820, 3821, 3823,
3824, 3825, 3827, 3828, 3829, 3831, 3832, 3834, 3835, 3836, 3838, 3839, 3840,
3841, 3843, 3844, 3845, 3847, 3848, 3849, 3850, 3851, 3853, 3854, 3855, 3856,
3858, 3859, 3860, 3861, 3862, 3863, 3865, 3866, 3867, 3868, 3869, 3870, 3871,
3873, 3874, 3875, 3876, 3877, 3878, 3879, 3880, 3881, 3882, 3884, 3885, 3886,
3887, 3888, 3889, 3890, 3891, 3892, 3893, 3894, 3895, 3896, 3897, 3898, 3900,
3901, 3902, 3903, 3904, 3905, 3906, 3907, 3908, 3909, 3910, 3911, 3912, 3913,
3914, 3915, 3916, 3917, 3918, 3919, 3920, 3922, 3923, 3924, 3925, 3926, 3927,
3928, 3929, 3930, 3931, 3932, 3933, 3934, 3935, 3936, 3937, 3938, 3939, 3940,
3941, 3942, 3943, 3944, 3945, 3946, 3947, 3948, 3949, 3950, 3951, 3952, 3953,
3954, 3955, 3956, 3957, 3958, 3959, 3960, 3961, 3962, 3963, 3964, 3965, 3966,
3967, 3968, 3969, 3970, 3971, 3972, 3973, 3974, 3975, 3976, 3977, 3978, 3979,
3979, 3980, 3981, 3982, 3983, 3984, 3985, 3986, 3987, 3988, 3989, 3990, 3991,
3992, 3992, 3993, 3994, 3995, 3996, 3997, 3998, 3999, 4000, 4001, 4002, 4002,
4003, 4004, 4005, 4006, 4007, 4008, 4009, 4009, 4010, 4011, 4012, 4013, 4014,
4015, 4015, 4016, 4017, 4018, 4019, 4020, 4020, 4021, 4022, 4023, 4024, 4024,
4025, 4026, 4027, 4028, 4028, 4029, 4030, 4031, 4032, 4032, 4033, 4034, 4035,
4035, 4036, 4037, 4038, 4039, 4039, 4040, 4041, 4041, 4042, 4043, 4044, 4044,
4045, 4046, 4047, 4047, 4048, 4049, 4049, 4050, 4051, 4051, 4052, 4053, 4053,
4054, 4055, 4055, 4056, 4057, 4057, 4058, 4059, 4059, 4060, 4061, 4061, 4062,
4062, 4063, 4064, 4064, 4065, 4065, 4066, 4067, 4067, 4068, 4068, 4069, 4069,
4070, 4071, 4071, 4072, 4072, 4073, 4073, 4074, 4074, 4075, 4075, 4076, 4076,
4077, 4077, 4078, 4078, 4079, 4079, 4080, 4080, 4081, 4081, 4082, 4082, 4082,
4083, 4083, 4084, 4084, 4085, 4085, 4085, 4086, 4086, 4087, 4087, 4087, 4088,
4088, 4088, 4089, 4089, 4089, 4090, 4090, 4090, 4091, 4091, 4091, 4092, 4092,
4092, 4093, 4093, 4093, 4093, 4094, 4094, 4094, 4095, 4095, 4095, 4095, 4095,
4095, 4095, 4095, 4095, 4095, 4095, 4095, 4095, 4095, 4095, 4095, 4095, 4095,
4095, 4095, 4095, 4095, 4095, 4095, 4095, 4095, 4095, 4095, 4095, 4095, 4095,
4095, 4095,
};


static struct snsr_cfg_node_s snsr_cfg_test = {
	.snsr = {
		.sns_type = ISP_SNS_I2C_TYPE,
		.regs_num = 4,
		.i2c_data[0] = {
			.update = 1,
			.i2c_dev = 1,
			.dev_addr = 0x1A,
			.dly_frm_num = 0,
			.reg_addr = 0x3001,
			.addr_bytes = 2,
			.data = 1,
			.data_bytes = 1,
		},
		.i2c_data[1] = {
			.update = 1,
			.i2c_dev = 1,
			.dev_addr = 0x1A,
			.dly_frm_num = 0,
			.reg_addr = 0x3020,
			.addr_bytes = 2,
			.data = 31,
			.data_bytes = 1,
		},
		.i2c_data[2] = {
			.update = 1,
			.i2c_dev = 1,
			.dev_addr = 0x1A,
			.dly_frm_num = 0,
			.reg_addr = 0x3013,
			.addr_bytes = 2,
			.data = 0,
			.data_bytes = 1,
		},
		.i2c_data[3] = {
			.update = 1,
			.i2c_dev = 1,
			.dev_addr = 0x1A,
			.dly_frm_num = 0,
			.reg_addr = 0x3001,
			.addr_bytes = 2,
			.data = 0,
			.data_bytes = 1,
		},
		.use_snsr_sram = 1,
		.need_update = 0
	},
};

/*************************************************************
 *
 *************************************************************/

static void _fswdr_cfg(uint8_t idx, enum cvi_isp_raw raw)
{
	struct cvi_vip_isp_post_cfg *post_cfg;
	uint16_t i = 0, j = 0;

	post_cfg = (struct cvi_vip_isp_post_cfg *)i_cfg.tun_buf.post_vir[raw];

	//FSWDR
	post_cfg->tun_cfg[idx].fswdr_cfg.update = 1;
	post_cfg->tun_cfg[idx].fswdr_cfg.enable = 1;
	post_cfg->tun_cfg[idx].fswdr_cfg.mc_enable = rand() % 2;
	post_cfg->tun_cfg[idx].fswdr_cfg.out_sel = rand() % 4;
	post_cfg->tun_cfg[idx].fswdr_cfg.s_max = rand() % 104876;
	post_cfg->tun_cfg[idx].fswdr_cfg.mmap_mrg_mode = rand() % 2;
	post_cfg->tun_cfg[idx].fswdr_cfg.mmap_mrg_alph = rand() % 256;
	post_cfg->tun_cfg[idx].fswdr_cfg.fswdr_cfg.FS_LUMA_THD.bits.FS_LUMA_THD_L = rand() % 4096;
	post_cfg->tun_cfg[idx].fswdr_cfg.fswdr_cfg.FS_LUMA_THD.bits.FS_LUMA_THD_H = rand() % 4096;
	post_cfg->tun_cfg[idx].fswdr_cfg.fswdr_cfg.FS_SE_GAIN.bits.FS_LS_GAIN = rand() % 16384;
	post_cfg->tun_cfg[idx].fswdr_cfg.fswdr_cfg.FS_WGT.bits.FS_WGT_MIN = rand() % 256;
	post_cfg->tun_cfg[idx].fswdr_cfg.fswdr_cfg.FS_WGT.bits.FS_WGT_MAX = rand() % 256;
	post_cfg->tun_cfg[idx].fswdr_cfg.fswdr_cfg.FS_WGT_SLOPE.bits.FS_WGT_SLP = rand() % 524288;
}

static void _wbg_cfg(uint8_t idx, enum cvi_isp_raw raw)
{
	struct cvi_vip_isp_post_cfg *post_cfg;
	uint16_t i = 0, j = 0;

	post_cfg = (struct cvi_vip_isp_post_cfg *)i_cfg.tun_buf.post_vir[raw];

	//WBG
	for (i = 0; i < 3; i++) {
		post_cfg->tun_cfg[idx].wbg_cfg[i].update = 1;
		post_cfg->tun_cfg[idx].wbg_cfg[i].inst = 2 + i;
		post_cfg->tun_cfg[idx].wbg_cfg[i].enable = 1;
		post_cfg->tun_cfg[idx].wbg_cfg[i].bypass = 0;
		post_cfg->tun_cfg[idx].wbg_cfg[i].rgain = 64;
		post_cfg->tun_cfg[idx].wbg_cfg[i].bgain = 64;
		post_cfg->tun_cfg[idx].wbg_cfg[i].ggain = 64;
	}
}

static void _lsc_cfg(uint8_t idx, enum cvi_isp_raw raw)
{
	struct cvi_vip_isp_post_cfg *post_cfg;
	uint16_t i = 0, j = 0;

	post_cfg = (struct cvi_vip_isp_post_cfg *)i_cfg.tun_buf.post_vir[raw];

	//LSC
	post_cfg->tun_cfg[idx].lsc_cfg.update = 1;
	post_cfg->tun_cfg[idx].lsc_cfg.enable = rand() % 2;
	post_cfg->tun_cfg[idx].lsc_cfg.gain_base = 0;
	post_cfg->tun_cfg[idx].lsc_cfg.strength = 4095;
	post_cfg->tun_cfg[idx].lsc_cfg.debug = rand() % 2;
}

static void _dpc_cfg(uint8_t idx, enum cvi_isp_raw raw)
{
	struct cvi_vip_isp_post_cfg *post_cfg;
	uint16_t i = 0, j = 0;

	post_cfg = (struct cvi_vip_isp_post_cfg *)i_cfg.tun_buf.post_vir[raw];

	//DPC
	for (i = 0; i < 2; i++) {
		post_cfg->tun_cfg[idx].dpc_cfg[i].update = 1;
		post_cfg->tun_cfg[idx].dpc_cfg[i].inst = i;
		post_cfg->tun_cfg[idx].dpc_cfg[i].enable = rand() % 2;
		post_cfg->tun_cfg[idx].dpc_cfg[i].cluster_size = rand() % 4;
		post_cfg->tun_cfg[idx].dpc_cfg[i].staticbpc_enable = 1;
		post_cfg->tun_cfg[idx].dpc_cfg[i].bp_cnt = 8;
		for (j = 0; j < 8; j++)
			post_cfg->tun_cfg[idx].dpc_cfg[i].bp_tbl[j] = isp_bp_tbl[j];

		post_cfg->tun_cfg[idx].dpc_cfg[i].dpc_cfg.DPC_3.bits.DPC_R_BRIGHT_PIXEL_RATIO = 512;
		post_cfg->tun_cfg[idx].dpc_cfg[i].dpc_cfg.DPC_3.bits.DPC_G_BRIGHT_PIXEL_RATIO = 512;
		post_cfg->tun_cfg[idx].dpc_cfg[i].dpc_cfg.DPC_4.bits.DPC_B_BRIGHT_PIXEL_RATIO = 512;
		post_cfg->tun_cfg[idx].dpc_cfg[i].dpc_cfg.DPC_4.bits.DPC_R_DARK_PIXEL_RATIO = 256;
		post_cfg->tun_cfg[idx].dpc_cfg[i].dpc_cfg.DPC_5.bits.DPC_G_DARK_PIXEL_RATIO = 256;
		post_cfg->tun_cfg[idx].dpc_cfg[i].dpc_cfg.DPC_5.bits.DPC_B_DARK_PIXEL_RATIO = 256;
		post_cfg->tun_cfg[idx].dpc_cfg[i].dpc_cfg.DPC_6.bits.DPC_R_DARK_PIXEL_MINDIFF = 128;
		post_cfg->tun_cfg[idx].dpc_cfg[i].dpc_cfg.DPC_6.bits.DPC_G_DARK_PIXEL_MINDIFF = 128;
		post_cfg->tun_cfg[idx].dpc_cfg[i].dpc_cfg.DPC_6.bits.DPC_B_DARK_PIXEL_MINDIFF = 128;
		post_cfg->tun_cfg[idx].dpc_cfg[i].dpc_cfg.DPC_7.bits.DPC_R_BRIGHT_PIXEL_UPBOUD_RATIO = 64;
		post_cfg->tun_cfg[idx].dpc_cfg[i].dpc_cfg.DPC_7.bits.DPC_G_BRIGHT_PIXEL_UPBOUD_RATIO = 64;
		post_cfg->tun_cfg[idx].dpc_cfg[i].dpc_cfg.DPC_7.bits.DPC_B_BRIGHT_PIXEL_UPBOUD_RATIO = 64;
		post_cfg->tun_cfg[idx].dpc_cfg[i].dpc_cfg.DPC_8.bits.DPC_FLAT_THRE_MIN_RB = 32;
		post_cfg->tun_cfg[idx].dpc_cfg[i].dpc_cfg.DPC_8.bits.DPC_FLAT_THRE_MIN_G = 32;
		post_cfg->tun_cfg[idx].dpc_cfg[i].dpc_cfg.DPC_9.bits.DPC_FLAT_THRE_R = 64;
		post_cfg->tun_cfg[idx].dpc_cfg[i].dpc_cfg.DPC_9.bits.DPC_FLAT_THRE_G = 64;
		post_cfg->tun_cfg[idx].dpc_cfg[i].dpc_cfg.DPC_9.bits.DPC_FLAT_THRE_B = 64;
	}
}

static void _ge_cfg(uint8_t idx, enum cvi_isp_raw raw)
{
	struct cvi_vip_isp_post_cfg *post_cfg;
	uint16_t i = 0, j = 0;

	post_cfg = (struct cvi_vip_isp_post_cfg *)i_cfg.tun_buf.post_vir[raw];

	//GE
	for (i = 0; i < 2; i++) {
		post_cfg->tun_cfg[idx].ge_cfg[i].update = 1;
		post_cfg->tun_cfg[idx].ge_cfg[i].inst = i;
		post_cfg->tun_cfg[idx].ge_cfg[i].enable = 1;
		post_cfg->tun_cfg[idx].ge_cfg[i].ge_cfg.DPC_10.bits.GE_STRENGTH = 0xa;
		post_cfg->tun_cfg[idx].ge_cfg[i].ge_cfg.DPC_10.bits.GE_COMBINEWEIGHT = 0x3;
		post_cfg->tun_cfg[idx].ge_cfg[i].ge_cfg.DPC_11.bits.GE_THRE1    = 0x100;
		post_cfg->tun_cfg[idx].ge_cfg[i].ge_cfg.DPC_11.bits.GE_THRE2    = 0x100;
		post_cfg->tun_cfg[idx].ge_cfg[i].ge_cfg.DPC_12.bits.GE_THRE3    = 0x200;
		post_cfg->tun_cfg[idx].ge_cfg[i].ge_cfg.DPC_12.bits.GE_THRE4    = 0x200;
		post_cfg->tun_cfg[idx].ge_cfg[i].ge_cfg.DPC_13.bits.GE_THRE11   = 0x300;
		post_cfg->tun_cfg[idx].ge_cfg[i].ge_cfg.DPC_13.bits.GE_THRE21   = 0x300;
		post_cfg->tun_cfg[idx].ge_cfg[i].ge_cfg.DPC_14.bits.GE_THRE31   = 0x400;
		post_cfg->tun_cfg[idx].ge_cfg[i].ge_cfg.DPC_14.bits.GE_THRE41   = 0x400;
		post_cfg->tun_cfg[idx].ge_cfg[i].ge_cfg.DPC_15.bits.GE_THRE12   = 0x500;
		post_cfg->tun_cfg[idx].ge_cfg[i].ge_cfg.DPC_15.bits.GE_THRE22   = 0x500;
		post_cfg->tun_cfg[idx].ge_cfg[i].ge_cfg.DPC_16.bits.GE_THRE32   = 0x600;
		post_cfg->tun_cfg[idx].ge_cfg[i].ge_cfg.DPC_16.bits.GE_THRE42   = 0x600;
	}
}

static void _blc_cfg(uint8_t idx, enum cvi_isp_raw raw)
{
	struct cvi_vip_isp_post_cfg *post_cfg;
	uint16_t i = 0, j = 0;

	post_cfg = (struct cvi_vip_isp_post_cfg *)i_cfg.tun_buf.post_vir[raw];

	for (i = 0; i < 2; i++) {
		post_cfg->tun_cfg[idx].blc_cfg[i].update = 1;
		post_cfg->tun_cfg[idx].blc_cfg[i].inst = 2 + i;
		post_cfg->tun_cfg[idx].blc_cfg[i].enable = 1;
		post_cfg->tun_cfg[idx].blc_cfg[i].rgain = 64;
		post_cfg->tun_cfg[idx].blc_cfg[i].bgain = 64;
		post_cfg->tun_cfg[idx].blc_cfg[i].grgain = 128;
		post_cfg->tun_cfg[idx].blc_cfg[i].gbgain = 128;
	}
}

static void _isp_tuning_ctrl(uint8_t tuning_update_idx, enum cvi_isp_raw raw)
{
	struct cvi_vip_isp_pre_cfg *pre_cfg;
	struct cvi_vip_isp_post_cfg *post_cfg;
	uint16_t i = 0, j = 0;
	uint8_t idx = tuning_update_idx;

	ut_pr(UT_INFO, "Tuning Update idx(%d)\n", tuning_update_idx);

	pre_cfg = (struct cvi_vip_isp_pre_cfg *)i_cfg.tun_buf.pre_vir[raw];
	pre_cfg->tun_idx = tuning_update_idx;
	pre_cfg->tun_update[tuning_update_idx] = 0;

	for (i = 0; i < 2; i++) {
		pre_cfg->tun_cfg[idx].blc_cfg[i].inst = i;
		pre_cfg->tun_cfg[idx].blc_cfg[i].enable = rand() % 2;
		pre_cfg->tun_cfg[idx].blc_cfg[i].bgain = 128;
		pre_cfg->tun_cfg[idx].blc_cfg[i].rgain = 64;
		pre_cfg->tun_cfg[idx].blc_cfg[i].grgain = 64;
		pre_cfg->tun_cfg[idx].blc_cfg[i].gbgain = 128;

		pre_cfg->tun_cfg[idx].wbg_cfg[i].inst = i;
		pre_cfg->tun_cfg[idx].wbg_cfg[i].bypass = 0;
		pre_cfg->tun_cfg[idx].wbg_cfg[i].enable = 1;
		pre_cfg->tun_cfg[idx].wbg_cfg[i].rgain = 64;
		pre_cfg->tun_cfg[idx].wbg_cfg[i].bgain = 64;
		pre_cfg->tun_cfg[idx].wbg_cfg[i].ggain = 64;
	}

	//LSCR
	pre_cfg->tun_cfg[idx].lscr_cfg.enable = 1;
	pre_cfg->tun_cfg[idx].lscr_cfg.strength = 2048;
	pre_cfg->tun_cfg[idx].lscr_cfg.centerx = i_cfg.s.w / 2;
	pre_cfg->tun_cfg[idx].lscr_cfg.centery = i_cfg.s.h / 2;
	for (j = 0; j < 32; j++)
		pre_cfg->tun_cfg[idx].lscr_cfg.gain_lut[j] = ut_lscr_gain_lut[j];

	//Postraw tuning update
	post_cfg = (struct cvi_vip_isp_post_cfg *)i_cfg.tun_buf.post_vir[raw];
	post_cfg->tun_idx = tuning_update_idx;
	post_cfg->tun_update[tuning_update_idx] = 1;

	_blc_cfg(idx, raw);
	_ge_cfg(idx, raw);
	_dpc_cfg(idx, raw);
	_lsc_cfg(idx, raw);
	_wbg_cfg(idx, raw);
	_fswdr_cfg(idx, raw);
	//DRC
	post_cfg->tun_cfg[idx].drc_cfg.update = 1;
	post_cfg->tun_cfg[idx].drc_cfg.ltm_enable = rand() % 2;
	post_cfg->tun_cfg[idx].drc_cfg.lmap_enable = rand() % 2;
	post_cfg->tun_cfg[idx].drc_cfg.dark_enh_en = rand() % 2;
	post_cfg->tun_cfg[idx].drc_cfg.brit_enh_en = rand() % 2;
	post_cfg->tun_cfg[idx].drc_cfg.dark_lce_en = rand() % 2;
	post_cfg->tun_cfg[idx].drc_cfg.brit_lce_en = rand() % 2;
	post_cfg->tun_cfg[idx].drc_cfg.dbg_en = rand() % 2;
	post_cfg->tun_cfg[idx].drc_cfg.dbg_mode = rand() % 4;
	post_cfg->tun_cfg[idx].drc_cfg.bcrv_quan_bit = rand() % 16;
	post_cfg->tun_cfg[idx].drc_cfg.gcrv_quan_bit_1 = rand() % 16;
	post_cfg->tun_cfg[idx].drc_cfg.lmap_w_bit = rand() % 4 + 3;
	post_cfg->tun_cfg[idx].drc_cfg.lmap_h_bit =
						post_cfg->tun_cfg[idx].drc_cfg.lmap_w_bit;
	post_cfg->tun_cfg[idx].drc_cfg.lmap_thd_l = rand() % 4096;
	post_cfg->tun_cfg[idx].drc_cfg.lmap_thd_h = rand() % 4096;
	//To runtime change y_mode seems will cause csibdg fifo overflow.
	post_cfg->tun_cfg[idx].drc_cfg.lmap_y_mode = 0;
	post_cfg->tun_cfg[idx].drc_cfg.cfa_hflp_strth = rand() % 256;
	for (j = 0; j < 11; j++) {
		post_cfg->tun_cfg[idx].drc_cfg.lmap0_lp_dist_wgt[j]	= ltm_lp_dist_wgt[j];
		post_cfg->tun_cfg[idx].drc_cfg.lmap1_lp_dist_wgt[j]	= ltm_lp_dist_wgt[j];
		post_cfg->tun_cfg[idx].drc_cfg.de_dist_wgt[j]		= ltm_de_dist_wgt[j];
		post_cfg->tun_cfg[idx].drc_cfg.be_dist_wgt[j]		= ltm_be_dist_wgt[j];
	}

	for (j = 0; j < 30; j++) {
		post_cfg->tun_cfg[idx].drc_cfg.lmap0_lp_diff_wgt[j]	= ltm_lp_diff_wgt[j];
		post_cfg->tun_cfg[idx].drc_cfg.lmap1_lp_diff_wgt[j]	= ltm_lp_diff_wgt[j];
		post_cfg->tun_cfg[idx].drc_cfg.de_luma_wgt[j]		= ltm_de_luma_wgt[j];
	}

	for (j = 0; j < 257; j++)
		post_cfg->tun_cfg[idx].drc_cfg.dark_lut[j] = ltm_d_lut[j];
	for (j = 0; j < 513; j++)
		post_cfg->tun_cfg[idx].drc_cfg.brit_lut[j] = ltm_b_lut[j];
	for (j = 0; j < 769; j++)
		post_cfg->tun_cfg[idx].drc_cfg.deflt_lut[j] = ltm_g_lut[j];

	post_cfg->tun_cfg[idx].drc_cfg.drc_cfg.CFA_CTRL_1.bits.CFA_NP_YMIN = rand() % 4096;
	post_cfg->tun_cfg[idx].drc_cfg.drc_cfg.CFA_CTRL_1.bits.CFA_NP_YSLOPE = rand() % 256;
	post_cfg->tun_cfg[idx].drc_cfg.drc_cfg.CFA_CTRL_2.bits.CFA_NP_LOW = rand() % 256;
	post_cfg->tun_cfg[idx].drc_cfg.drc_cfg.CFA_CTRL_2.bits.CFA_NP_HIGH = rand() % 256;
	post_cfg->tun_cfg[idx].drc_cfg.drc_cfg.CFA_CTRL_3.bits.CFA_DIFFTHD_MIN = rand() % 4096;
	post_cfg->tun_cfg[idx].drc_cfg.drc_cfg.CFA_CTRL_3.bits.CFA_DIFFTHD_SLOPE = rand() % 256;
	post_cfg->tun_cfg[idx].drc_cfg.drc_cfg.CFA_CTRL_4.bits.CFA_DIFFW_LOW = rand() % 256;
	post_cfg->tun_cfg[idx].drc_cfg.drc_cfg.CFA_CTRL_4.bits.CFA_DIFFW_HIGH = rand() % 256;
	post_cfg->tun_cfg[idx].drc_cfg.drc_cfg.CFA_CTRL_5.bits.CFA_SADTHD_MIN = rand() % 4096;
	post_cfg->tun_cfg[idx].drc_cfg.drc_cfg.CFA_CTRL_5.bits.CFA_SADTHD_SLOPE = rand() % 256;
	post_cfg->tun_cfg[idx].drc_cfg.drc_cfg.CFA_CTRL_6.bits.CFA_SADW_LOW = rand() % 256;
	post_cfg->tun_cfg[idx].drc_cfg.drc_cfg.CFA_CTRL_6.bits.CFA_SADW_HIGH = rand() % 256;
	post_cfg->tun_cfg[idx].drc_cfg.drc_cfg.CFA_CTRL_7.bits.CFA_LUMATHD_MIN = rand() % 4096;
	post_cfg->tun_cfg[idx].drc_cfg.drc_cfg.CFA_CTRL_7.bits.CFA_LUMATHD_SLOPE = rand() % 256;
	post_cfg->tun_cfg[idx].drc_cfg.drc_cfg.CFA_CTRL_8.bits.CFA_LUMAW_LOW = rand() % 256;
	post_cfg->tun_cfg[idx].drc_cfg.drc_cfg.CFA_CTRL_8.bits.CFA_LUMAW_HIGH = rand() % 256;

	//TNR
	post_cfg->tun_cfg[idx].tnr_cfg.update = 1;
	post_cfg->tun_cfg[idx].tnr_cfg.manr_enable = 1;
	post_cfg->tun_cfg[idx].tnr_cfg.mmap_mrg_mode = 1;
	post_cfg->tun_cfg[idx].tnr_cfg.mmap_mrg_alph = 128;
	post_cfg->tun_cfg[idx].tnr_cfg.rgbmap_w_bit = (rand() % 3) + 3;
	post_cfg->tun_cfg[idx].tnr_cfg.rgbmap_h_bit = post_cfg->tun_cfg[idx].tnr_cfg.rgbmap_w_bit;
	//post_cfg->tun_cfg[idx].tnr_cfg.mscaler_filter = ut_manr_data;

	post_cfg->tun_cfg[idx].tnr_cfg.tnr_cfg.REG_04.bits.MMAP_0_LPF_00 = 3;
	post_cfg->tun_cfg[idx].tnr_cfg.tnr_cfg.REG_04.bits.MMAP_0_LPF_01 = 4;
	post_cfg->tun_cfg[idx].tnr_cfg.tnr_cfg.REG_04.bits.MMAP_0_LPF_02 = 3;
	post_cfg->tun_cfg[idx].tnr_cfg.tnr_cfg.REG_04.bits.MMAP_0_LPF_10 = 4;
	post_cfg->tun_cfg[idx].tnr_cfg.tnr_cfg.REG_04.bits.MMAP_0_LPF_11 = 4;
	post_cfg->tun_cfg[idx].tnr_cfg.tnr_cfg.REG_04.bits.MMAP_0_LPF_12 = 4;
	post_cfg->tun_cfg[idx].tnr_cfg.tnr_cfg.REG_04.bits.MMAP_0_LPF_20 = 3;
	post_cfg->tun_cfg[idx].tnr_cfg.tnr_cfg.REG_04.bits.MMAP_0_LPF_21 = 4;
	post_cfg->tun_cfg[idx].tnr_cfg.tnr_cfg.REG_04.bits.MMAP_0_LPF_22 = 3;

	post_cfg->tun_cfg[idx].tnr_cfg.tnr_cfg.REG_08.bits.MMAP_0_MAP_CORING = 0;
	post_cfg->tun_cfg[idx].tnr_cfg.tnr_cfg.REG_08.bits.MMAP_0_MAP_GAIN   = 64;
	post_cfg->tun_cfg[idx].tnr_cfg.tnr_cfg.REG_08.bits.MMAP_0_MAP_THD_L  = 0;
	post_cfg->tun_cfg[idx].tnr_cfg.tnr_cfg.REG_08.bits.MMAP_0_MAP_THD_H  = 255;

	post_cfg->tun_cfg[idx].tnr_cfg.tnr_cfg.REG_0C.bits.MMAP_0_LUMA_ADAPT_LUT_IN_0 = 0;
	post_cfg->tun_cfg[idx].tnr_cfg.tnr_cfg.REG_0C.bits.MMAP_0_LUMA_ADAPT_LUT_IN_1 = 600;
	post_cfg->tun_cfg[idx].tnr_cfg.tnr_cfg.REG_10.bits.MMAP_0_LUMA_ADAPT_LUT_IN_2 = 1500;
	post_cfg->tun_cfg[idx].tnr_cfg.tnr_cfg.REG_10.bits.MMAP_0_LUMA_ADAPT_LUT_IN_3 = 2500;

	post_cfg->tun_cfg[idx].tnr_cfg.tnr_cfg.REG_14.bits.MMAP_0_LUMA_ADAPT_LUT_OUT_0 = 63;
	post_cfg->tun_cfg[idx].tnr_cfg.tnr_cfg.REG_14.bits.MMAP_0_LUMA_ADAPT_LUT_OUT_1 = 48;
	post_cfg->tun_cfg[idx].tnr_cfg.tnr_cfg.REG_14.bits.MMAP_0_LUMA_ADAPT_LUT_OUT_2 = 8;
	post_cfg->tun_cfg[idx].tnr_cfg.tnr_cfg.REG_14.bits.MMAP_0_LUMA_ADAPT_LUT_OUT_3 = 2;

	post_cfg->tun_cfg[idx].tnr_cfg.tnr_cfg.REG_18.bits.MMAP_0_LUMA_ADAPT_LUT_SLOPE_0 = 27;
	post_cfg->tun_cfg[idx].tnr_cfg.tnr_cfg.REG_18.bits.MMAP_0_LUMA_ADAPT_LUT_SLOPE_1 = 2;
	post_cfg->tun_cfg[idx].tnr_cfg.tnr_cfg.REG_1C.bits.MMAP_0_LUMA_ADAPT_LUT_SLOPE_2 = 3;
	post_cfg->tun_cfg[idx].tnr_cfg.tnr_cfg.REG_1C.bits.MMAP_0_MAP_DSHIFT_BIT = 5;

	post_cfg->tun_cfg[idx].tnr_cfg.tnr_cfg.REG_20.bits.MMAP_0_IIR_PRTCT_LUT_IN_0 = 0;
	post_cfg->tun_cfg[idx].tnr_cfg.tnr_cfg.REG_20.bits.MMAP_0_IIR_PRTCT_LUT_IN_1 = 45;
	post_cfg->tun_cfg[idx].tnr_cfg.tnr_cfg.REG_20.bits.MMAP_0_IIR_PRTCT_LUT_IN_2 = 90;
	post_cfg->tun_cfg[idx].tnr_cfg.tnr_cfg.REG_20.bits.MMAP_0_IIR_PRTCT_LUT_IN_3 = 255;

	post_cfg->tun_cfg[idx].tnr_cfg.tnr_cfg.REG_24.bits.MMAP_0_IIR_PRTCT_LUT_OUT_0 = 6;
	post_cfg->tun_cfg[idx].tnr_cfg.tnr_cfg.REG_24.bits.MMAP_0_IIR_PRTCT_LUT_OUT_1 = 10;
	post_cfg->tun_cfg[idx].tnr_cfg.tnr_cfg.REG_24.bits.MMAP_0_IIR_PRTCT_LUT_OUT_2 = 9;
	post_cfg->tun_cfg[idx].tnr_cfg.tnr_cfg.REG_24.bits.MMAP_0_IIR_PRTCT_LUT_OUT_3 = 2;

	post_cfg->tun_cfg[idx].tnr_cfg.tnr_cfg.REG_28.bits.MMAP_0_IIR_PRTCT_LUT_SLOPE_0 = 12;
	post_cfg->tun_cfg[idx].tnr_cfg.tnr_cfg.REG_28.bits.MMAP_0_IIR_PRTCT_LUT_SLOPE_1 = 4;
	post_cfg->tun_cfg[idx].tnr_cfg.tnr_cfg.REG_2C.bits.MMAP_0_IIR_PRTCT_LUT_SLOPE_2 = 4;

	post_cfg->tun_cfg[idx].tnr_cfg.tnr_1_cfg.REG_34.bits.MMAP_1_LPF_00 = 1;
	post_cfg->tun_cfg[idx].tnr_cfg.tnr_1_cfg.REG_34.bits.MMAP_1_LPF_01 = 1;
	post_cfg->tun_cfg[idx].tnr_cfg.tnr_1_cfg.REG_34.bits.MMAP_1_LPF_02 = 1;
	post_cfg->tun_cfg[idx].tnr_cfg.tnr_1_cfg.REG_34.bits.MMAP_1_LPF_10 = 1;
	post_cfg->tun_cfg[idx].tnr_cfg.tnr_1_cfg.REG_34.bits.MMAP_1_LPF_11 = 1;
	post_cfg->tun_cfg[idx].tnr_cfg.tnr_1_cfg.REG_34.bits.MMAP_1_LPF_12 = 1;
	post_cfg->tun_cfg[idx].tnr_cfg.tnr_1_cfg.REG_34.bits.MMAP_1_LPF_20 = 1;
	post_cfg->tun_cfg[idx].tnr_cfg.tnr_1_cfg.REG_34.bits.MMAP_1_LPF_21 = 1;
	post_cfg->tun_cfg[idx].tnr_cfg.tnr_1_cfg.REG_34.bits.MMAP_1_LPF_22 = 1;

	post_cfg->tun_cfg[idx].tnr_cfg.tnr_1_cfg.REG_38.bits.MMAP_1_MAP_CORING = 0;
	post_cfg->tun_cfg[idx].tnr_cfg.tnr_1_cfg.REG_38.bits.MMAP_1_MAP_GAIN   = 13;
	post_cfg->tun_cfg[idx].tnr_cfg.tnr_1_cfg.REG_38.bits.MMAP_1_MAP_THD_L  = 0;
	post_cfg->tun_cfg[idx].tnr_cfg.tnr_1_cfg.REG_38.bits.MMAP_1_MAP_THD_H  = 255;

	post_cfg->tun_cfg[idx].tnr_cfg.tnr_1_cfg.REG_3C.bits.MMAP_1_LUMA_ADAPT_LUT_IN_0 = 0;
	post_cfg->tun_cfg[idx].tnr_cfg.tnr_1_cfg.REG_3C.bits.MMAP_1_LUMA_ADAPT_LUT_IN_1 = 600;
	post_cfg->tun_cfg[idx].tnr_cfg.tnr_1_cfg.REG_40.bits.MMAP_1_LUMA_ADAPT_LUT_IN_2 = 1500;
	post_cfg->tun_cfg[idx].tnr_cfg.tnr_1_cfg.REG_40.bits.MMAP_1_LUMA_ADAPT_LUT_IN_3 = 2500;

	post_cfg->tun_cfg[idx].tnr_cfg.tnr_1_cfg.REG_44.bits.MMAP_1_LUMA_ADAPT_LUT_OUT_0 = 32;
	post_cfg->tun_cfg[idx].tnr_cfg.tnr_1_cfg.REG_44.bits.MMAP_1_LUMA_ADAPT_LUT_OUT_1 = 16;
	post_cfg->tun_cfg[idx].tnr_cfg.tnr_1_cfg.REG_44.bits.MMAP_1_LUMA_ADAPT_LUT_OUT_2 = 16;
	post_cfg->tun_cfg[idx].tnr_cfg.tnr_1_cfg.REG_44.bits.MMAP_1_LUMA_ADAPT_LUT_OUT_3 = 16;

	post_cfg->tun_cfg[idx].tnr_cfg.tnr_1_cfg.REG_48.bits.MMAP_1_LUMA_ADAPT_LUT_SLOPE_0 = 1;
	post_cfg->tun_cfg[idx].tnr_cfg.tnr_1_cfg.REG_48.bits.MMAP_1_LUMA_ADAPT_LUT_SLOPE_1 = 1;

	post_cfg->tun_cfg[idx].tnr_cfg.tnr_1_cfg.REG_4C.bits.MMAP_1_LUMA_ADAPT_LUT_SLOPE_2 = 1;
	post_cfg->tun_cfg[idx].tnr_cfg.tnr_1_cfg.REG_4C.bits.MMAP_1_MAP_DSHIFT_BIT = 5;

	post_cfg->tun_cfg[idx].tnr_cfg.tnr_1_cfg.REG_50.bits.MMAP_1_IIR_PRTCT_LUT_IN_0 = 0;
	post_cfg->tun_cfg[idx].tnr_cfg.tnr_1_cfg.REG_50.bits.MMAP_1_IIR_PRTCT_LUT_IN_1 = 45;
	post_cfg->tun_cfg[idx].tnr_cfg.tnr_1_cfg.REG_50.bits.MMAP_1_IIR_PRTCT_LUT_IN_2 = 90;
	post_cfg->tun_cfg[idx].tnr_cfg.tnr_1_cfg.REG_50.bits.MMAP_1_IIR_PRTCT_LUT_IN_3 = 255;

	post_cfg->tun_cfg[idx].tnr_cfg.tnr_1_cfg.REG_54.bits.MMAP_1_IIR_PRTCT_LUT_OUT_0 = 12;
	post_cfg->tun_cfg[idx].tnr_cfg.tnr_1_cfg.REG_54.bits.MMAP_1_IIR_PRTCT_LUT_OUT_1 = 15;
	post_cfg->tun_cfg[idx].tnr_cfg.tnr_1_cfg.REG_54.bits.MMAP_1_IIR_PRTCT_LUT_OUT_2 = 12;
	post_cfg->tun_cfg[idx].tnr_cfg.tnr_1_cfg.REG_54.bits.MMAP_1_IIR_PRTCT_LUT_OUT_3 = 1;

	post_cfg->tun_cfg[idx].tnr_cfg.tnr_1_cfg.REG_58.bits.MMAP_1_IIR_PRTCT_LUT_SLOPE_0 = 1;
	post_cfg->tun_cfg[idx].tnr_cfg.tnr_1_cfg.REG_58.bits.MMAP_1_IIR_PRTCT_LUT_SLOPE_1 = 1;
	post_cfg->tun_cfg[idx].tnr_cfg.tnr_1_cfg.REG_5C.bits.MMAP_1_IIR_PRTCT_LUT_SLOPE_2 = 1;

	post_cfg->tun_cfg[idx].tnr_cfg.tnr_2_cfg.REG_70.bits.MMAP_0_GAIN_RATIO_R = 4096;
	post_cfg->tun_cfg[idx].tnr_cfg.tnr_2_cfg.REG_70.bits.MMAP_0_GAIN_RATIO_G = 4096;
	post_cfg->tun_cfg[idx].tnr_cfg.tnr_2_cfg.REG_74.bits.MMAP_0_GAIN_RATIO_B = 4096;

	post_cfg->tun_cfg[idx].tnr_cfg.tnr_2_cfg.REG_78.bits.MMAP_0_NS_SLOPE_R = 5;
	post_cfg->tun_cfg[idx].tnr_cfg.tnr_2_cfg.REG_78.bits.MMAP_0_NS_SLOPE_G = 4;
	post_cfg->tun_cfg[idx].tnr_cfg.tnr_2_cfg.REG_7C.bits.MMAP_0_NS_SLOPE_B = 6;

	post_cfg->tun_cfg[idx].tnr_cfg.tnr_2_cfg.REG_80.bits.MMAP_0_NS_LUMA_TH0_R = 16;
	post_cfg->tun_cfg[idx].tnr_cfg.tnr_2_cfg.REG_80.bits.MMAP_0_NS_LUMA_TH0_G = 16;
	post_cfg->tun_cfg[idx].tnr_cfg.tnr_2_cfg.REG_84.bits.MMAP_0_NS_LUMA_TH0_B = 16;

	post_cfg->tun_cfg[idx].tnr_cfg.tnr_2_cfg.REG_84.bits.MMAP_0_NS_LOW_OFFSET_R = 1;
	post_cfg->tun_cfg[idx].tnr_cfg.tnr_2_cfg.REG_88.bits.MMAP_0_NS_LOW_OFFSET_G = 2;
	post_cfg->tun_cfg[idx].tnr_cfg.tnr_2_cfg.REG_88.bits.MMAP_0_NS_LOW_OFFSET_B = 1;
	post_cfg->tun_cfg[idx].tnr_cfg.tnr_2_cfg.REG_8C.bits.MMAP_0_NS_HIGH_OFFSET_R = 724;
	post_cfg->tun_cfg[idx].tnr_cfg.tnr_2_cfg.REG_8C.bits.MMAP_0_NS_HIGH_OFFSET_G = 724;
	post_cfg->tun_cfg[idx].tnr_cfg.tnr_2_cfg.REG_90.bits.MMAP_0_NS_HIGH_OFFSET_B = 724;

	post_cfg->tun_cfg[idx].tnr_cfg.tnr_3_cfg.REG_A0.bits.MMAP_1_GAIN_RATIO_R = 4096;
	post_cfg->tun_cfg[idx].tnr_cfg.tnr_3_cfg.REG_A0.bits.MMAP_1_GAIN_RATIO_G = 4096;
	post_cfg->tun_cfg[idx].tnr_cfg.tnr_3_cfg.REG_A4.bits.MMAP_1_GAIN_RATIO_B = 4096;

	post_cfg->tun_cfg[idx].tnr_cfg.tnr_3_cfg.REG_A8.bits.MMAP_1_NS_SLOPE_R = 5 * 4;
	post_cfg->tun_cfg[idx].tnr_cfg.tnr_3_cfg.REG_A8.bits.MMAP_1_NS_SLOPE_G = 4 * 4;
	post_cfg->tun_cfg[idx].tnr_cfg.tnr_3_cfg.REG_AC.bits.MMAP_1_NS_SLOPE_B = 6 * 4;

	post_cfg->tun_cfg[idx].tnr_cfg.tnr_3_cfg.REG_B0.bits.MMAP_1_NS_LUMA_TH0_R = 16;
	post_cfg->tun_cfg[idx].tnr_cfg.tnr_3_cfg.REG_B0.bits.MMAP_1_NS_LUMA_TH0_G = 16;
	post_cfg->tun_cfg[idx].tnr_cfg.tnr_3_cfg.REG_B4.bits.MMAP_1_NS_LUMA_TH0_B = 16;

	post_cfg->tun_cfg[idx].tnr_cfg.tnr_3_cfg.REG_B4.bits.MMAP_1_NS_LOW_OFFSET_R = 1;
	post_cfg->tun_cfg[idx].tnr_cfg.tnr_3_cfg.REG_B8.bits.MMAP_1_NS_LOW_OFFSET_G = 1;
	post_cfg->tun_cfg[idx].tnr_cfg.tnr_3_cfg.REG_B8.bits.MMAP_1_NS_LOW_OFFSET_B = 1;

	post_cfg->tun_cfg[idx].tnr_cfg.tnr_3_cfg.REG_BC.bits.MMAP_1_NS_HIGH_OFFSET_R = 724;
	post_cfg->tun_cfg[idx].tnr_cfg.tnr_3_cfg.REG_BC.bits.MMAP_1_NS_HIGH_OFFSET_G = 724;
	post_cfg->tun_cfg[idx].tnr_cfg.tnr_3_cfg.REG_C0.bits.MMAP_1_NS_HIGH_OFFSET_B = 724;

	post_cfg->tun_cfg[idx].tnr_cfg.tnr_4_cfg.REG_13.bits.REG_3DNR_LUT_IN_0 = rand() % 256;
	post_cfg->tun_cfg[idx].tnr_cfg.tnr_4_cfg.REG_13.bits.REG_3DNR_LUT_IN_1 = rand() % 256;
	post_cfg->tun_cfg[idx].tnr_cfg.tnr_4_cfg.REG_13.bits.REG_3DNR_LUT_IN_2 = rand() % 256;
	post_cfg->tun_cfg[idx].tnr_cfg.tnr_4_cfg.REG_13.bits.REG_3DNR_LUT_IN_3 = rand() % 256;

	post_cfg->tun_cfg[idx].tnr_cfg.tnr_4_cfg.REG_14.bits.REG_3DNR_LUT_OUT_0 = rand() % 256;
	post_cfg->tun_cfg[idx].tnr_cfg.tnr_4_cfg.REG_14.bits.REG_3DNR_LUT_OUT_1 = rand() % 256;
	post_cfg->tun_cfg[idx].tnr_cfg.tnr_4_cfg.REG_14.bits.REG_3DNR_LUT_OUT_2 = rand() % 256;
	post_cfg->tun_cfg[idx].tnr_cfg.tnr_4_cfg.REG_14.bits.REG_3DNR_LUT_OUT_3 = rand() % 256;

	post_cfg->tun_cfg[idx].tnr_cfg.tnr_4_cfg.REG_15.bits.REG_3DNR_LUT_SLOPE_0 = rand() % 4096;
	post_cfg->tun_cfg[idx].tnr_cfg.tnr_4_cfg.REG_15.bits.REG_3DNR_LUT_SLOPE_1 = rand() % 4096;

	post_cfg->tun_cfg[idx].tnr_cfg.tnr_4_cfg.REG_16.bits.REG_3DNR_LUT_SLOPE_2 = rand() % 4096;
	post_cfg->tun_cfg[idx].tnr_cfg.tnr_4_cfg.REG_16.bits.MOTION_SEL = rand() % 2;
	post_cfg->tun_cfg[idx].tnr_cfg.tnr_4_cfg.REG_16.bits.REG_3DNR_BETA_MAX = rand() % 256;

	//BNR
	post_cfg->tun_cfg[idx].bnr_cfg.update = 1;
	post_cfg->tun_cfg[idx].bnr_cfg.enable = rand() % 2;
	for (j = 0; j < 8; j++)
		post_cfg->tun_cfg[idx].bnr_cfg.intensity_sel[j] = ut_bnr_intensity_sel[j];
	for (j = 0; j < 256; j++)
		post_cfg->tun_cfg[idx].bnr_cfg.weight_lut[j] = ut_bnr_weight_lut[j];

	post_cfg->tun_cfg[idx].bnr_cfg.k_smooth = 2;
	post_cfg->tun_cfg[idx].bnr_cfg.k_texture = 4;
	post_cfg->tun_cfg[idx].bnr_cfg.weight_intra_0 = 11;
	post_cfg->tun_cfg[idx].bnr_cfg.weight_intra_1 = 11;
	post_cfg->tun_cfg[idx].bnr_cfg.weight_intra_2 = 11;
	post_cfg->tun_cfg[idx].bnr_cfg.weight_norm_1 = 64;
	post_cfg->tun_cfg[idx].bnr_cfg.weight_norm_2 = 128;
	post_cfg->tun_cfg[idx].bnr_cfg.out_sel = 8;
	post_cfg->tun_cfg[idx].bnr_cfg.lsc_en = 1;
	post_cfg->tun_cfg[idx].bnr_cfg.lsc_strenth = 128;
	post_cfg->tun_cfg[idx].bnr_cfg.lsc_centerx = 2048;
	post_cfg->tun_cfg[idx].bnr_cfg.lsc_centery = 1024;
	post_cfg->tun_cfg[idx].bnr_cfg.lsc_norm = 12000;
	for (j = 0; j < 32; j++)
		post_cfg->tun_cfg[idx].bnr_cfg.lsc_gain_lut[j] = ut_bnr_lsc_lut[j];

	post_cfg->tun_cfg[idx].bnr_cfg.bnr_1_cfg.NS_GAIN.raw = 100;
	post_cfg->tun_cfg[idx].bnr_cfg.bnr_1_cfg.NS_LUMA_TH_B.raw = 22;
	post_cfg->tun_cfg[idx].bnr_cfg.bnr_1_cfg.NS_LUMA_TH_GB.raw = 22;
	post_cfg->tun_cfg[idx].bnr_cfg.bnr_1_cfg.NS_LUMA_TH_GR.raw = 22;
	post_cfg->tun_cfg[idx].bnr_cfg.bnr_1_cfg.NS_LUMA_TH_R.raw = 22;
	post_cfg->tun_cfg[idx].bnr_cfg.bnr_1_cfg.NS_OFFSET0_B.raw = 10;
	post_cfg->tun_cfg[idx].bnr_cfg.bnr_1_cfg.NS_OFFSET0_GB.raw = 10;
	post_cfg->tun_cfg[idx].bnr_cfg.bnr_1_cfg.NS_OFFSET0_GR.raw = 10;
	post_cfg->tun_cfg[idx].bnr_cfg.bnr_1_cfg.NS_OFFSET0_R.raw = 10;
	post_cfg->tun_cfg[idx].bnr_cfg.bnr_1_cfg.NS_OFFSET1_B.raw = 128;
	post_cfg->tun_cfg[idx].bnr_cfg.bnr_1_cfg.NS_OFFSET1_GB.raw = 128;
	post_cfg->tun_cfg[idx].bnr_cfg.bnr_1_cfg.NS_OFFSET1_GR.raw = 128;
	post_cfg->tun_cfg[idx].bnr_cfg.bnr_1_cfg.NS_OFFSET1_R.raw = 128;
	post_cfg->tun_cfg[idx].bnr_cfg.bnr_1_cfg.NS_SLOPE_B.raw  = 100;
	post_cfg->tun_cfg[idx].bnr_cfg.bnr_1_cfg.NS_SLOPE_GB.raw  = 100;
	post_cfg->tun_cfg[idx].bnr_cfg.bnr_1_cfg.NS_SLOPE_GR.raw  = 100;
	post_cfg->tun_cfg[idx].bnr_cfg.bnr_1_cfg.NS_SLOPE_R.raw  = 100;
	post_cfg->tun_cfg[idx].bnr_cfg.bnr_1_cfg.STRENGTH_MODE.raw = 128;

	post_cfg->tun_cfg[idx].bnr_cfg.bnr_2_cfg.LSC_RATIO.raw = 16;
	post_cfg->tun_cfg[idx].bnr_cfg.bnr_2_cfg.NEIGHBOR_MAX.raw = 1;
	post_cfg->tun_cfg[idx].bnr_cfg.bnr_2_cfg.VAR_TH.raw = 255;
	post_cfg->tun_cfg[idx].bnr_cfg.bnr_2_cfg.WEIGHT_D135.raw = 16;
	post_cfg->tun_cfg[idx].bnr_cfg.bnr_2_cfg.WEIGHT_D45.raw = 16;
	post_cfg->tun_cfg[idx].bnr_cfg.bnr_2_cfg.WEIGHT_H.raw = 16;
	post_cfg->tun_cfg[idx].bnr_cfg.bnr_2_cfg.WEIGHT_V.raw = 16;
	post_cfg->tun_cfg[idx].bnr_cfg.bnr_2_cfg.WEIGHT_SM.raw = 16;

	//Demosiac
	post_cfg->tun_cfg[idx].demosiac_cfg.update = 1;
	post_cfg->tun_cfg[idx].demosiac_cfg.cfa_enable = rand() % 2;
	post_cfg->tun_cfg[idx].demosiac_cfg.cfa_moire_enable = rand() % 2;
	post_cfg->tun_cfg[idx].demosiac_cfg.cfa_out_sel = rand() % 2;
	post_cfg->tun_cfg[idx].demosiac_cfg.rgbee_enable = rand() % 2;
	post_cfg->tun_cfg[idx].demosiac_cfg.rgbee_osgain = 0x100;
	post_cfg->tun_cfg[idx].demosiac_cfg.rgbee_usgain = 0x128;
	for (j = 0; j < 32; j++)
		post_cfg->tun_cfg[idx].demosiac_cfg.cfa_ghp_lut[j] = ut_cfa_ghp_lut[j];
	for (j = 0; j < 33; j++) {
		post_cfg->tun_cfg[idx].demosiac_cfg.rgbee_ac_lut[j]	= ut_rgbee_ac_lut[j];
		post_cfg->tun_cfg[idx].demosiac_cfg.rgbee_edge_lut[j]	= ut_rgbee_edge_lut[j];
		post_cfg->tun_cfg[idx].demosiac_cfg.rgbee_np_lut[j]	= ut_rgbee_np_lut[j];
	}

	post_cfg->tun_cfg[idx].demosiac_cfg.demosiac_cfg.REG_3.bits.CFA_EDGEE_THD = 0x100;
	post_cfg->tun_cfg[idx].demosiac_cfg.demosiac_cfg.REG_3.bits.CFA_SIGE_THD = 0x100;
	post_cfg->tun_cfg[idx].demosiac_cfg.demosiac_cfg.REG_4.bits.CFA_GSIG_TOL = 0x200;
	post_cfg->tun_cfg[idx].demosiac_cfg.demosiac_cfg.REG_4.bits.CFA_RBSIG_TOL = 0x200;
	post_cfg->tun_cfg[idx].demosiac_cfg.demosiac_cfg.REG_4_1.bits.CFA_EDGE_TOL = 0x300;
	post_cfg->tun_cfg[idx].demosiac_cfg.demosiac_cfg.REG_5.bits.CFA_GHP_THD = 0x310;

	post_cfg->tun_cfg[idx].demosiac_cfg.demosiac_1_cfg.REG_10.bits.CFA_MOIRE_STRTH = 0x10;
	post_cfg->tun_cfg[idx].demosiac_cfg.demosiac_1_cfg.REG_10.bits.CFA_MOIRE_WGHT_GAIN = 0x20;
	post_cfg->tun_cfg[idx].demosiac_cfg.demosiac_1_cfg.REG_10.bits.CFA_MOIRE_NP_YSLOPE = 0x30;
	post_cfg->tun_cfg[idx].demosiac_cfg.demosiac_1_cfg.REG_11.bits.CFA_MOIRE_NP_YMIN = 0x40;
	post_cfg->tun_cfg[idx].demosiac_cfg.demosiac_1_cfg.REG_11.bits.CFA_MOIRE_NP_LOW = 0x50;
	post_cfg->tun_cfg[idx].demosiac_cfg.demosiac_1_cfg.REG_11.bits.CFA_MOIRE_NP_HIGH = 0x60;
	post_cfg->tun_cfg[idx].demosiac_cfg.demosiac_1_cfg.REG_12.bits.CFA_MOIRE_DIFFTHD_MIN = 0x70;
	post_cfg->tun_cfg[idx].demosiac_cfg.demosiac_1_cfg.REG_12.bits.CFA_MOIRE_DIFFTHD_SLOPE = 0x80;
	post_cfg->tun_cfg[idx].demosiac_cfg.demosiac_1_cfg.REG_13.bits.CFA_MOIRE_DIFFW_LOW = 0x90;
	post_cfg->tun_cfg[idx].demosiac_cfg.demosiac_1_cfg.REG_13.bits.CFA_MOIRE_DIFFW_HIGH = 0xa0;
	post_cfg->tun_cfg[idx].demosiac_cfg.demosiac_1_cfg.REG_13.bits.CFA_MOIRE_SADTHD_MIN = 0xb0;
	post_cfg->tun_cfg[idx].demosiac_cfg.demosiac_1_cfg.REG_14.bits.CFA_MOIRE_SADTHD_SLOPE = 0xc0;
	post_cfg->tun_cfg[idx].demosiac_cfg.demosiac_1_cfg.REG_14.bits.CFA_MOIRE_SADW_LOW = 0xd0;
	post_cfg->tun_cfg[idx].demosiac_cfg.demosiac_1_cfg.REG_14.bits.CFA_MOIRE_SADW_HIGH = 0xe0;
	post_cfg->tun_cfg[idx].demosiac_cfg.demosiac_1_cfg.REG_15.bits.CFA_MOIRE_LUMAW_LOW = 0xf0;
	post_cfg->tun_cfg[idx].demosiac_cfg.demosiac_1_cfg.REG_15.bits.CFA_MOIRE_LUMAW_HIGH = 0xf1;
	post_cfg->tun_cfg[idx].demosiac_cfg.demosiac_1_cfg.REG_16.bits.CFA_MOIRE_LUMATHD_MIN = 0xf2;
	post_cfg->tun_cfg[idx].demosiac_cfg.demosiac_1_cfg.REG_16.bits.CFA_MOIRE_LUMATHD_SLOPE = 0xf3;

	//GAMMA
	post_cfg->tun_cfg[idx].gamma_cfg.update = 1;
	post_cfg->tun_cfg[idx].gamma_cfg.enable = 1;
	for (j = 0; j < 256; j++)
		post_cfg->tun_cfg[idx].gamma_cfg.lut[j] = ut_gamma_lut[j];

	//YNR
	post_cfg->tun_cfg[idx].ynr_cfg.update = 1;
	post_cfg->tun_cfg[idx].ynr_cfg.enable = 1;
	post_cfg->tun_cfg[idx].ynr_cfg.alpha_gain = 256;
	post_cfg->tun_cfg[idx].ynr_cfg.k_smooth = 67;
	post_cfg->tun_cfg[idx].ynr_cfg.k_texture = 88;
	post_cfg->tun_cfg[idx].ynr_cfg.out_sel = 8;
	post_cfg->tun_cfg[idx].ynr_cfg.var_th = 32;
	post_cfg->tun_cfg[idx].ynr_cfg.weight_intra_0 = 6;
	post_cfg->tun_cfg[idx].ynr_cfg.weight_intra_1 = 6;
	post_cfg->tun_cfg[idx].ynr_cfg.weight_intra_2 = 6;
	post_cfg->tun_cfg[idx].ynr_cfg.weight_norm_1 = 4;
	post_cfg->tun_cfg[idx].ynr_cfg.weight_norm_2 = 8;

	post_cfg->tun_cfg[idx].ynr_cfg.ynr_1_cfg.NS_GAIN.raw = 16;
	post_cfg->tun_cfg[idx].ynr_cfg.ynr_1_cfg.STRENGTH_MODE.raw = 0;
	post_cfg->tun_cfg[idx].ynr_cfg.ynr_1_cfg.MOTION_POS_GAIN.raw = 4;
	post_cfg->tun_cfg[idx].ynr_cfg.ynr_1_cfg.MOTION_NS_TH.raw = 4;
	post_cfg->tun_cfg[idx].ynr_cfg.ynr_1_cfg.MOTION_NEG_GAIN.raw = 2;
	post_cfg->tun_cfg[idx].ynr_cfg.ynr_2_cfg.NEIGHBOR_MAX.raw = 1;
	post_cfg->tun_cfg[idx].ynr_cfg.ynr_2_cfg.WEIGHT_D135.raw = 7;
	post_cfg->tun_cfg[idx].ynr_cfg.ynr_2_cfg.WEIGHT_D45.raw = 15;
	post_cfg->tun_cfg[idx].ynr_cfg.ynr_2_cfg.WEIGHT_H.raw = 20;
	post_cfg->tun_cfg[idx].ynr_cfg.ynr_2_cfg.WEIGHT_SM.raw = 29;
	post_cfg->tun_cfg[idx].ynr_cfg.ynr_2_cfg.WEIGHT_V.raw = 23;

	for (j = 0; j < 64; j++)
		post_cfg->tun_cfg[idx].ynr_cfg.weight_lut_h[j] = ut_ynr_weight_lut[j];

	for (j = 0; j < 8; j++)
		post_cfg->tun_cfg[idx].ynr_cfg.intensity_sel[j] = ut_ynr_intensity_sel[j];

	for (j = 0; j < 5; j++) {
		post_cfg->tun_cfg[idx].ynr_cfg.ns0_slope[j] = ut_ynr_ns0_slope[j];
		post_cfg->tun_cfg[idx].ynr_cfg.ns1_slope[j] = ut_ynr_ns1_slope[j];
	}
	for (j = 0; j < 6; j++) {
		post_cfg->tun_cfg[idx].ynr_cfg.ns0_luma_th[j] = ut_ynr_ns0_luma_th[j];
		post_cfg->tun_cfg[idx].ynr_cfg.ns0_offset_th[j] = ut_ynr_ns0_offset[j];
		post_cfg->tun_cfg[idx].ynr_cfg.ns1_luma_th[j] = ut_ynr_ns1_luma_th[j];
		post_cfg->tun_cfg[idx].ynr_cfg.ns1_offset_th[j] = ut_ynr_ns1_offset[j];
	}

	//Pfc
	post_cfg->tun_cfg[idx].pfc_cfg.update = 1;
	post_cfg->tun_cfg[idx].pfc_cfg.enable = 1;
	post_cfg->tun_cfg[idx].pfc_cfg.out_sel = 1;
	post_cfg->tun_cfg[idx].pfc_cfg.var_th = 256;
	post_cfg->tun_cfg[idx].pfc_cfg.correct_strength = 128;
	post_cfg->tun_cfg[idx].pfc_cfg.purple_th = 45;
	post_cfg->tun_cfg[idx].pfc_cfg.pfc_cfg.CNR_03.bits.CNR_PURPLE_CR = 177;
	post_cfg->tun_cfg[idx].pfc_cfg.pfc_cfg.CNR_03.bits.CNR_GREEN_CB = 43;
	post_cfg->tun_cfg[idx].pfc_cfg.pfc_cfg.CNR_04.bits.CNR_GREEN_CR = 21;
	post_cfg->tun_cfg[idx].pfc_cfg.pfc_cfg.CNR_04.bits.CNR_PURPLE_CB = 232;

	//CNR
	post_cfg->tun_cfg[idx].cnr_cfg.update = 1;
	post_cfg->tun_cfg[idx].cnr_cfg.diff_gain = 4;
	post_cfg->tun_cfg[idx].cnr_cfg.diff_shift_val = 0;
	post_cfg->tun_cfg[idx].cnr_cfg.enable = 1;
	post_cfg->tun_cfg[idx].cnr_cfg.flag_neighbor_max_weight = 1;
	post_cfg->tun_cfg[idx].cnr_cfg.fusion_intensity_weight = 4;
	post_cfg->tun_cfg[idx].cnr_cfg.ratio = 220;
	post_cfg->tun_cfg[idx].cnr_cfg.strength_mode = 32;
	for (j = 0; j < 16; j++)
		post_cfg->tun_cfg[idx].cnr_cfg.weight_lut_inter[j] = ut_cnr_weight_lut[j];

	for (j = 0; j < 8; j++)
		post_cfg->tun_cfg[idx].cnr_cfg.intensity_sel[j] = ut_cnr_intensity_sel[j];

	//DCI
	post_cfg->tun_cfg[idx].dci_cfg.update = 1;
	post_cfg->tun_cfg[idx].dci_cfg.enable = rand() % 2;
	post_cfg->tun_cfg[idx].dci_cfg.map_enable = rand() % 2;
	post_cfg->tun_cfg[idx].dci_cfg.dither_enable = rand() % 2;
	post_cfg->tun_cfg[idx].dci_cfg.demo_mode = rand() % 2;
	for (j = 0; j < 256; j++)
		post_cfg->tun_cfg[idx].dci_cfg.map_lut[j] = ut_dci_lut[j];

	//EE
	post_cfg->tun_cfg[idx].ee_cfg.update = 1;
	post_cfg->tun_cfg[idx].ee_cfg.enable = 1;
	post_cfg->tun_cfg[idx].ee_cfg.dbg_mode = 0;
	post_cfg->tun_cfg[idx].ee_cfg.total_coring = 128;
	post_cfg->tun_cfg[idx].ee_cfg.total_gain = 16;

	for (j = 0; j < 33; j++) {
		post_cfg->tun_cfg[idx].ee_cfg.luma_coring_lut[j] = ut_luma_coring_lut[j];
		post_cfg->tun_cfg[idx].ee_cfg.luma_adptctrl_lut[j] = ut_luma_adptctrl_lut[j];
		post_cfg->tun_cfg[idx].ee_cfg.delta_adptctrl_lut[j] = ut_delta_adptctrl_lut[j];
		post_cfg->tun_cfg[idx].ee_cfg.luma_shtctrl_lut[j] = ut_luma_shtctrl_lut[j];
		post_cfg->tun_cfg[idx].ee_cfg.delta_shtctrl_lut[j] = ut_delta_shtctrl_lut[j];
	}

	post_cfg->tun_cfg[idx].ee_cfg.ee_cfg.REG_04.raw = 100;
	post_cfg->tun_cfg[idx].ee_cfg.ee_cfg.REG_08.raw = 110;
	post_cfg->tun_cfg[idx].ee_cfg.ee_cfg.REG_0C.raw = 120;
	post_cfg->tun_cfg[idx].ee_cfg.ee_cfg.REG_10.raw = 130;
	post_cfg->tun_cfg[idx].ee_cfg.ee_cfg.REG_14.raw = 140;
	post_cfg->tun_cfg[idx].ee_cfg.ee_cfg.REG_18.raw = 150;
	post_cfg->tun_cfg[idx].ee_cfg.ee_cfg.REG_1C.raw = 160;
	post_cfg->tun_cfg[idx].ee_cfg.ee_cfg.REG_20.raw = 170;
	post_cfg->tun_cfg[idx].ee_cfg.ee_cfg.REG_24.raw = 180;
	post_cfg->tun_cfg[idx].ee_cfg.ee_cfg.REG_28.raw = 190;
	post_cfg->tun_cfg[idx].ee_cfg.ee_cfg.REG_2C.raw = 200;
	post_cfg->tun_cfg[idx].ee_cfg.ee_cfg.REG_30.raw = 210;
	post_cfg->tun_cfg[idx].ee_cfg.ee_cfg.REG_34.raw = 220;
	post_cfg->tun_cfg[idx].ee_cfg.ee_cfg.REG_38.raw = 230;
	post_cfg->tun_cfg[idx].ee_cfg.ee_cfg.REG_3C.raw = 240;
	post_cfg->tun_cfg[idx].ee_cfg.ee_cfg.REG_40.raw = 250;
	post_cfg->tun_cfg[idx].ee_cfg.ee_cfg.REG_58.raw = 260;
	post_cfg->tun_cfg[idx].ee_cfg.ee_cfg.REG_5C.raw = 270;
	post_cfg->tun_cfg[idx].ee_cfg.ee_cfg.REG_60.raw = 280;
	post_cfg->tun_cfg[idx].ee_cfg.ee_cfg.REG_64.raw = 290;
	post_cfg->tun_cfg[idx].ee_cfg.ee_cfg.REG_68.raw = 300;
	post_cfg->tun_cfg[idx].ee_cfg.ee_cfg.REG_6C.raw = 310;
	post_cfg->tun_cfg[idx].ee_cfg.ee_cfg.REG_70.raw = 320;
	post_cfg->tun_cfg[idx].ee_cfg.ee_cfg.REG_74.raw = 330;
	post_cfg->tun_cfg[idx].ee_cfg.ee_cfg.REG_78.raw = 340;

	//3DLUT
	post_cfg->tun_cfg[idx].thrdlut_cfg.update = 1;
	post_cfg->tun_cfg[idx].thrdlut_cfg.enable = 1;
	post_cfg->tun_cfg[idx].thrdlut_cfg.h_clamp_wrap_opt = 1;
	for (j = 0; j < 3276; j++) {
		post_cfg->tun_cfg[idx].thrdlut_cfg.h_lut[j] = ut_C_lut[j];
		post_cfg->tun_cfg[idx].thrdlut_cfg.s_lut[j] = ut_C_lut[j];
		post_cfg->tun_cfg[idx].thrdlut_cfg.v_lut[j] = ut_C_lut[j];
	}
}

static inline enum cvi_errno _isp_tuning_init(void)
{
	enum cvi_errno ret = ERR_NONE;
	struct isp_tuning_cfg tun_cfg;
	uint8_t i = 0;

	i_cfg.isp_devm_fd = devm_open();

	ISP_EXT_CTRL(ut_fd_isp, &tun_cfg, V4L2_CID_DV_VIP_ISP_GET_TUN_ADDR);

	for (i = 0; i < ISP_PRERAW_MAX; i++) {
#ifdef __arm__
		ut_pr(UT_INFO, "pre_addr[%d]=0x%llx, post_addr[%d]=0x%llx\n",
				i, tun_cfg.pre_addr[i], i, tun_cfg.post_addr[i]);
#else
		ut_pr(UT_INFO, "pre_addr[%d]=0x%lx, post_addr[%d]=0x%lx\n",
				i, tun_cfg.pre_addr[i], i, tun_cfg.post_addr[i]);
#endif
		i_cfg.tun_buf.pre_addr[i] = tun_cfg.pre_addr[i];
		i_cfg.tun_buf.post_addr[i] = tun_cfg.post_addr[i];
	}

	for (i = 0; i < ISP_PRERAW_MAX; i++) {
		i_cfg.tun_buf.pre_vir[i] = devm_map(i_cfg.isp_devm_fd, i_cfg.tun_buf.pre_addr[i],
							sizeof(struct cvi_vip_isp_pre_cfg));
		i_cfg.tun_buf.post_vir[i] = devm_map(i_cfg.isp_devm_fd, i_cfg.tun_buf.post_addr[i],
							sizeof(struct cvi_vip_isp_post_cfg));
		ut_pr(UT_INFO, "pre_vir[%d]=0x%p, post_vir[%d]=0x%p, pre_size=%ld, post_size=%ld\n",
				i, i_cfg.tun_buf.pre_vir[i], i, i_cfg.tun_buf.post_vir[i],
				sizeof(struct cvi_vip_isp_pre_cfg), sizeof(struct cvi_vip_isp_post_cfg));
	}

	_isp_tuning_ctrl(i_cfg.tuning_idx[ISP_PRERAW_A], ISP_PRERAW_A);
	_isp_tuning_ctrl(i_cfg.tuning_idx[ISP_PRERAW_B], ISP_PRERAW_B);

	return ret;
}

static enum cvi_errno _devm_release(void)
{
	enum cvi_errno ret = ERR_NONE;
	uint8_t i = 0;

	for (i = 0; i < ISP_PRERAW_MAX; i++) {
		devm_unmap((void *)i_cfg.tun_buf.pre_vir[i], sizeof(struct cvi_vip_isp_pre_cfg));
		devm_unmap((void *)i_cfg.tun_buf.post_vir[i], sizeof(struct cvi_vip_isp_post_cfg));
	}

	devm_close(i_cfg.isp_devm_fd);

	return ret;
}

static void _isp_stsBuf_init(void)
{
	uint32_t i = 0, j = 0;
	struct v4l2_ext_controls ecs1;
	struct v4l2_ext_control ec1;

	memset(&ecs1, 0, sizeof(ecs1));
	memset(&ec1, 0, sizeof(ec1));

	for (i = 0; i < ISP_PRERAW_MAX; i++) {
		for (j = 0; j < STS_BUF_NUM; j++) {
			memset(&(stsBuf[i][j]), 0, sizeof(struct cvi_isp_sts_mem));
			stsBuf[i][j].raw_num = i;
		}

		ec1.id = V4L2_CID_DV_VIP_ISP_STS_MEM;
		ec1.ptr = &stsBuf[i][0];
		ec1.size = sizeof(struct cvi_isp_sts_mem) * STS_BUF_NUM;
		ecs1.controls = &ec1;
		ecs1.count = 1;
		ecs1.ctrl_class = V4L2_CTRL_ID2CLASS(ec1.id);

		if (ioctl(ut_fd_isp, VIDIOC_G_EXT_CTRLS, &ecs1) < 0)
			ut_pr(UT_INFO, "%s VIDIOC_G_EXT_CTRLS NG.\n", __func__);

		ut_pr(UT_INFO, "stsBuf_%d paddr=%p\n", i, (void *)stsBuf[i][0].ae_le0.phy_addr);
	}
}

static void isp_csibdg_cfg(void)
{
	struct vip_msg_ctx msg_1;
	struct snr_csibdg_info csibdg_info;
	__u64 bayer_phy_addr[2];
	int ret;

	csibdg_info.hdr_on = 1;
	csibdg_info.w = 1280;
	csibdg_info.h = 720;

	msg_1.cmd = CSIBDG_CTRL;
	msg_1.indata = (void *)&csibdg_info;
	msg_1.retdata = (void *)bayer_phy_addr;

	struct snr_csibdg_info *tmp = (struct snr_csibdg_info *)msg_1.indata;

	MSGSND("isp", "isp", msg_1);

	ut_pr(UT_INFO, "[%s][%d] phy_addr_1=0x%llx\n", __func__, __LINE__, bayer_phy_addr[0]);
	if (csibdg_info.hdr_on == 1)
		ut_pr(UT_INFO, "[%s][%d] phy_addr_2=0x%llx\n", __func__, __LINE__, bayer_phy_addr[1]);

	//msg_1.cmd = ISP_CTRL_RELEASE;
	//msg_1.indata = NULL;
	//msg_1.retdata = NULL;

	//MSGSND("isp", "isp", msg_1);

	//while (1);
}

static enum cvi_errno _isp_flow_ctrl(struct cvi_isp_snr_info *cfg)
{
	enum cvi_errno ret = ERR_NONE;
	uint8_t op, val;

	struct v4l2_ext_controls ecs1;
	struct v4l2_ext_control ec1;

	ut_pr(UT_INFO, "Enable Patgen(1/0)\n");
	scanf("%d", (int *)&val);

	if (val)
		system("echo 1,0 > /sys/module/cvitek_video_vip/parameters/csi_patgen_en");
	else
		system("echo 0,0 > /sys/module/cvitek_video_vip/parameters/csi_patgen_en");

	val = 0;

	ut_pr(UT_INFO, "00) Enable HDR  01) Enable Tile  255) Normal\n");
	scanf("%d", (int *)&op);

	if (op != 255) {
		ut_pr(UT_INFO, "Enable/Disable(1/0):\n");
		scanf("%d", (int *)&val);
	}

	switch (op) {
	case 0: //Enable HDR
	{
		memset(&ecs1, 0, sizeof(ecs1));
		memset(&ec1, 0, sizeof(ec1));
		ec1.id = V4L2_CID_DV_VIP_ISP_HDR;
		ec1.value = val;
		ecs1.controls = &ec1;
		ecs1.count = 1;
		ecs1.ctrl_class = V4L2_CTRL_ID2CLASS(ec1.id);
		ret = ut_v4l2_cmd(ut_fd_isp, VIDIOC_S_EXT_CTRLS, (void *)&ecs1);

		if (val == 1)
			cfg->snr_fmt.frm_num = 2;
	}
	break;

	case 1: //Enable Tile
	{
		memset(&ecs1, 0, sizeof(ecs1));
		memset(&ec1, 0, sizeof(ec1));
		ec1.id = V4L2_CID_DV_VIP_ISP_TILE;
		ec1.value = val;
		ecs1.controls = &ec1;
		ecs1.count = 1;
		ecs1.ctrl_class = V4L2_CTRL_ID2CLASS(ec1.id);
		ret = ut_v4l2_cmd(ut_fd_isp, VIDIOC_S_EXT_CTRLS, (void *)&ecs1);
	}
	break;

	case 255:
	default:
	break;
	}

	ut_pr(UT_INFO, "RGBmap_prevbuf_idx: 1 to 5\n");
	scanf("%d", (int *)&val);

	memset(&ecs1, 0, sizeof(ecs1));
	memset(&ec1, 0, sizeof(ec1));
	ec1.id = V4L2_CID_DV_VIP_ISP_SET_RGBMAP_IDX;
	ec1.value = val;
	ecs1.controls = &ec1;
	ecs1.count = 1;
	ecs1.ctrl_class = V4L2_CTRL_ID2CLASS(ec1.id);
	ut_v4l2_cmd(ut_fd_isp, VIDIOC_S_EXT_CTRLS, (void *)&ecs1);

	return ret;
}

static inline enum cvi_errno isp_bufChk(struct v4l2_buffer *buf)
{
	enum cvi_errno ret = ERR_NONE;

	if (isp_v4l2_bufs[dq_buf_idx].m.planes[0].m.userptr == buf->m.planes[0].m.userptr &&
		isp_v4l2_bufs[dq_buf_idx].m.planes[1].m.userptr == buf->m.planes[1].m.userptr &&
		isp_v4l2_bufs[dq_buf_idx].m.planes[2].m.userptr == buf->m.planes[2].m.userptr) {

		ut_pr(UT_INFO, "Buf chk pass\n");
	} else {
		ut_pr(UT_ERR, "DQ buf ba incorrect\n");
		ret = ISP_ERR_DQBUF_BA;
	}

	return ret;
}

static inline enum cvi_errno isp_DQbuf(void)
{
	enum cvi_errno ret = ERR_NONE;
	struct v4l2_buffer buf;
	struct v4l2_plane plane[ISP_BUF_PLANE];

	ZERO(buf);

	buf.type = i_cfg.buf_type;
	buf.memory = i_cfg.mem_type;
	buf.length = i_cfg.buf_plane_num;
	buf.m.planes = plane;

	ret = ut_v4l2_cmd(ut_fd_isp, VIDIOC_DQBUF, (void *)&buf);
#if 0
	ut_pr(UT_DBG, "DQ ba=0x%lx, size=%d\n", buf.m.planes[0].m.userptr, buf.m.planes[0].length);
	ut_pr(UT_DBG, "DQ ba=0x%lx, size=%d\n", buf.m.planes[1].m.userptr, buf.m.planes[1].length);
	ut_pr(UT_DBG, "DQ ba=0x%lx, size=%d\n", buf.m.planes[2].m.userptr, buf.m.planes[2].length);

	ret = isp_bufChk(&buf);
#endif
	return ret;
}

static inline enum cvi_errno isp_Qbuf(void)
{
	enum cvi_errno ret = ERR_NONE;

	ret = ut_v4l2_cmd(ut_fd_isp, VIDIOC_QBUF, (void *)&isp_v4l2_bufs[dq_buf_idx]);

	ut_pr(UT_INFO, "Q ba=0x%lx, size=%d\n",
			isp_v4l2_bufs[dq_buf_idx].m.planes[0].m.userptr, isp_v4l2_bufs[dq_buf_idx].m.planes[0].length);
	ut_pr(UT_INFO, "Q ba=0x%lx, size=%d\n",
			isp_v4l2_bufs[dq_buf_idx].m.planes[1].m.userptr, isp_v4l2_bufs[dq_buf_idx].m.planes[1].length);
	ut_pr(UT_INFO, "Q ba=0x%lx, size=%d\n",
			isp_v4l2_bufs[dq_buf_idx].m.planes[2].m.userptr, isp_v4l2_bufs[dq_buf_idx].m.planes[2].length);

	dq_buf_idx = (dq_buf_idx + 1) % ISP_BUF_NUM;

	return ret;
}

static inline enum cvi_errno isp_Qbuf_init(void)
{
	enum cvi_errno ret = ERR_NONE;

	uint8_t i = 0, j = 0;
	uint32_t size = 0, size_uv = 0;

	for (i = 0; i < i_cfg.buf_num; i++) {
		isp_v4l2_bufs[i].type = i_cfg.buf_type;
		isp_v4l2_bufs[i].memory = i_cfg.mem_type;
		isp_v4l2_bufs[i].index = i;
		isp_v4l2_bufs[i].length = i_cfg.buf_plane_num;
		isp_v4l2_bufs[i].m.planes = isp_v4l2_planes[i];

		if (i_cfg.pxlfmt == V4L2_PIX_FMT_YUV420M) {
			size = (ALIGN(i_cfg.s.w, 32) * i_cfg.s.h);
			size_uv = size / 4;
		} else /* Bayer 12bits */
			size = (ALIGN((i_cfg.s.w * 3 / 2), 32) * i_cfg.s.h);

		for (j = 0; j < i_cfg.buf_plane_num; j++) {
			if ((j > 0) && (i_cfg.pxlfmt == V4L2_PIX_FMT_YUV420M))
				size = size_uv;

			isp_v4l2_bufs[i].m.planes[j].m.userptr = i_cfg.alloc_base;
			isp_v4l2_bufs[i].m.planes[j].length = size;
			isp_v4l2_bufs[i].m.planes[j].bytesused = size;
			isp_v4l2_bufs[i].m.planes[j].data_offset = 0;

			i_cfg.alloc_base += size;

#ifdef __arm__
			ut_pr(UT_INFO, "ba=0x%llx, size=%d\n", i_cfg.alloc_base, size);
#else
			ut_pr(UT_INFO, "ba=0x%lx, size=%d\n", i_cfg.alloc_base, size);
#endif
		}

		ret = ut_v4l2_cmd(ut_fd_isp, VIDIOC_QBUF, (void *)&isp_v4l2_bufs[i]);
	}

	return ret;
}

static inline enum cvi_errno isp_wait_event(void)
{
	enum cvi_errno ret = ERR_NONE;
	fd_set fds;
	struct timeval tv;
	struct v4l2_event ev;
	int r, time_out_cnt = 0;

	ZERO(ev);

	/* Wait event */
	while (1) {
		FD_ZERO(&fds);
		FD_SET(ut_fd_isp, &fds);

		tv.tv_sec = 0;
		tv.tv_usec = 500 * 1000;
		r = select(ut_fd_isp + 1, &fds, &fds, NULL, &tv);

		if (r == -1) {
			ut_pr(UT_ERR, "%s: select err\n", __func__);
			ret = ISP_ERR_WAIT_EVENT;
			break;
		}

		if (r == 0) {
			ut_pr(UT_ERR, "%s: select timeout\n", __func__);
			ret = ISP_ERR_WAIT_EVENT_TIMEOUT;
			if (++time_out_cnt == 10)
				break;
			continue;
		}

		ret = ut_v4l2_cmd(ut_fd_isp, VIDIOC_DQEVENT, (void *)&ev);
		if (ret == ERR_NONE) {
			if (ev.type == V4L2_EVENT_CVI_VIP_PRE0_SOF) {
				ut_pr(UT_INFO, "Got SOF\n");
			} else if (ev.type == V4L2_EVENT_CVI_VIP_PRE0_EOF) {
				ut_pr(UT_INFO, "Got pre_raw done\n");
			} else if (ev.type == V4L2_EVENT_CVI_VIP_POST_EOF) {
				ut_pr(UT_INFO, "Got post_raw done, frm_id=%d\n", ev.u.frame_sync.frame_sequence);
				isp_get_stt(ut_fd_isp, ISP_PRERAW_A);
				i_cfg.tuning_idx[ISP_PRERAW_A] = ((i_cfg.tuning_idx[ISP_PRERAW_A] + 1) % 3);
				_isp_tuning_ctrl(i_cfg.tuning_idx[ISP_PRERAW_A], ISP_PRERAW_A);
				break;
			} else if (ev.type == V4L2_EVENT_CVI_VIP_POST1_EOF) {
				ut_pr(UT_INFO, "Got post1_raw done, frm_id=%d\n", ev.u.frame_sync.frame_sequence);
				isp_get_stt(ut_fd_isp, ISP_PRERAW_B);
				i_cfg.tuning_idx[ISP_PRERAW_B] = ((i_cfg.tuning_idx[ISP_PRERAW_B] + 1) % 3);
				_isp_tuning_ctrl(i_cfg.tuning_idx[ISP_PRERAW_B], ISP_PRERAW_B);
				break;
			}
		} else
			break;

		continue;
	}

	return ret;
}

static void _isp_param_init(void)
{
	uint8_t i = 0;

	for (; i < ISP_PRERAW_MAX; i++)
		i_cfg.tuning_idx[i] = 0;
	i_cfg.isp_devm_fd = 0;

	memset(&i_cfg.tun_buf, 0, sizeof(struct isp_tuning_cfg));
}

/*************************************************************
 *	Public	functions
 *************************************************************/
enum cvi_errno isp_init(void *priv)
{
	enum cvi_errno ret = ERR_NONE;
	const struct inparam *param = (const struct inparam *)priv;

#if 0
	isp_csibdg_cfg();
#endif

	_isp_param_init();

	UT_DEV_INIT(dev_isp, ut_fd_isp);

	struct v4l2_capability cap;

	ret = ut_v4l2_cmd(ut_fd_isp, VIDIOC_QUERYCAP, (void *)&cap);
	if (ret != ERR_NONE)
		goto ERR;

	if (!(cap.capabilities & V4L2_CAP_VIDEO_CAPTURE_MPLANE)) {
		ut_pr(UT_ERR, "no video capture-mplane device, cap(0x%x)\n",
			cap.capabilities);
		exit(EXIT_FAILURE);
	}

	ut_pr(UT_INFO, "caps returned %04x\n", cap.capabilities);

	if (!(cap.capabilities & V4L2_CAP_STREAMING)) {
		ut_pr(UT_ERR, "%s does not support streaming i/o\n", dev_isp);
		exit(EXIT_FAILURE);
	}

	ut_mem_init(ut_fd_isp, i_cfg.buf_num, i_cfg.buf_type, i_cfg.mem_type);

	struct v4l2_event_subscription data;

	ZERO(data);

	data.type = V4L2_EVENT_CVI_VIP_PRE0_SOF;
	ret = ut_v4l2_cmd(ut_fd_isp, VIDIOC_SUBSCRIBE_EVENT, (void *)&data);
	if (ret != ERR_NONE)
		goto ERR;

	data.type = V4L2_EVENT_CVI_VIP_PRE0_EOF;
	ret = ut_v4l2_cmd(ut_fd_isp, VIDIOC_SUBSCRIBE_EVENT, (void *)&data);
	if (ret != ERR_NONE)
		goto ERR;

	data.type = V4L2_EVENT_CVI_VIP_POST_EOF;
	ret = ut_v4l2_cmd(ut_fd_isp, VIDIOC_SUBSCRIBE_EVENT, (void *)&data);
	if (ret != ERR_NONE)
		goto ERR;

	data.type = V4L2_EVENT_CVI_VIP_POST1_EOF;
	ret = ut_v4l2_cmd(ut_fd_isp, VIDIOC_SUBSCRIBE_EVENT, (void *)&data);
	if (ret != ERR_NONE)
		goto ERR;

ERR:
	return ret;
}

enum cvi_errno isp_config(void *priv)
{
	enum cvi_errno ret = ERR_NONE;
	const struct inparam *param = (const struct inparam *)priv;
	struct v4l2_format fmt;
	uint8_t i;

	ZERO(fmt);

	fmt.type				= i_cfg.buf_type;
	fmt.fmt.pix_mp.width			= i_cfg.s.w;
	fmt.fmt.pix_mp.height			= i_cfg.s.h;
	fmt.fmt.pix_mp.pixelformat		= i_cfg.pxlfmt;
	fmt.fmt.pix_mp.field			= V4L2_FIELD_ANY;
	fmt.fmt.pix_mp.plane_fmt[0].sizeimage	= (ALIGN(i_cfg.s.w, 32) * i_cfg.s.h);
	fmt.fmt.pix_mp.plane_fmt[0].bytesperline = ALIGN(i_cfg.s.w, 32);
	fmt.fmt.pix_mp.plane_fmt[1].sizeimage	= (ALIGN(i_cfg.s.w, 32) * i_cfg.s.h) / 4;
	fmt.fmt.pix_mp.plane_fmt[1].bytesperline = ALIGN(i_cfg.s.w, 32);
	fmt.fmt.pix_mp.plane_fmt[2].sizeimage	= (ALIGN(i_cfg.s.w, 32) * i_cfg.s.h) / 4;
	fmt.fmt.pix_mp.plane_fmt[2].bytesperline = ALIGN(i_cfg.s.w, 32);

	//fmt.fmt.pix_mp.colorspace	=
	//	(i_cfg.pxlfmt == V4L2_PIX_FMT_RGBM) ? V4L2_COLORSPACE_SRGB : V4L2_COLORSPACE_SMPTE170M;
	fmt.fmt.pix_mp.num_planes	= i_cfg.buf_plane_num;

	ret = ut_v4l2_cmd(ut_fd_isp, VIDIOC_S_FMT, (void *)&fmt);
	if (ret != ERR_NONE)
		goto ERR;

	struct v4l2_ext_controls ecs1;
	struct v4l2_ext_control ec1;
	struct cvi_isp_usr_pic_cfg insrc_cfg;

	insrc_cfg.fmt.width = i_cfg.s.w;
	insrc_cfg.fmt.height = i_cfg.s.h;
	insrc_cfg.crop.width = i_cfg.s.w;
	insrc_cfg.crop.height = i_cfg.s.h;
	insrc_cfg.crop.left = 0;
	insrc_cfg.crop.top = 0;

	memset(&ecs1, 0, sizeof(ecs1));
	memset(&ec1, 0, sizeof(ec1));
	ec1.id = V4L2_CID_DV_VIP_ISP_USR_PIC_CFG;
	ec1.ptr = &insrc_cfg;

	ecs1.controls = &ec1;
	ecs1.count = 1;
	ecs1.ctrl_class = V4L2_CTRL_ID2CLASS(ec1.id);

	ret = ut_v4l2_cmd(ut_fd_isp, VIDIOC_S_EXT_CTRLS, (void *)&ecs1);
	if (ret != ERR_NONE)
		goto ERR;

	ret = isp_Qbuf_init();
	if (ret != ERR_NONE)
		goto ERR;

	struct cvi_isp_snr_info cfg;

	cfg.raw_num = 0;
	cfg.color_mode = MEDIA_BUS_FMT_SGBRG12_1X12;
	cfg.snr_fmt.frm_num = 1;

	if (param->manual_mode)
		_isp_flow_ctrl(&cfg);

	for (i = 0; i < cfg.snr_fmt.frm_num; i++) {
		cfg.snr_fmt.img_size[i].width = 1280;
		cfg.snr_fmt.img_size[i].height = 720;
		cfg.snr_fmt.img_size[i].start_x = 0;
		cfg.snr_fmt.img_size[i].start_y = 0;
		cfg.snr_fmt.img_size[i].active_w = 1280;
		cfg.snr_fmt.img_size[i].active_h = 720;
	}

	//ISP_EXT_CTRL(ut_fd_isp, &cfg, V4L2_CID_DV_VIP_ISP_SET_SNR_INFO);

ERR:
	return ret;
}

enum cvi_errno isp_start(void *priv)
{
	enum cvi_errno ret = ERR_NONE;
	const struct inparam *param = (const struct inparam *)priv;
	int data = V4L2_BUF_TYPE_VIDEO_CAPTURE_MPLANE;
	uint16_t repeat = 0;
	uint8_t i = 0;

	ret = _isp_tuning_init();
	if (ret != ERR_NONE)
		goto ERR;

	struct cvi_isp_snr_update cfg;

	memset(&cfg, 0, sizeof(struct cvi_isp_snr_update));

	cfg.snr_cfg_node.isp.need_update = 0;
	cfg.snr_cfg_node.isp.wdr.frm_num = 2;

	for (i = 0; i < cfg.snr_cfg_node.isp.wdr.frm_num; i++) {
		cfg.snr_cfg_node.isp.wdr.img_size[i].start_x = 0;
		cfg.snr_cfg_node.isp.wdr.img_size[i].start_y = 0;
		cfg.snr_cfg_node.isp.wdr.img_size[i].active_w = i_cfg.s.w;
		cfg.snr_cfg_node.isp.wdr.img_size[i].active_h = i_cfg.s.h;
		cfg.snr_cfg_node.isp.wdr.img_size[i].width = i_cfg.s.w;
		cfg.snr_cfg_node.isp.wdr.img_size[i].height = i_cfg.s.h;
	}

	cfg.snr_cfg_node.cif.need_update = 0;
	cfg.snr_cfg_node.cif.wdr_manu.devno = 0;
	cfg.snr_cfg_node.cif.wdr_manu.attr.manual_en = 1;
	cfg.snr_cfg_node.cif.wdr_manu.attr.l2s_distance = 8;
	cfg.snr_cfg_node.cif.wdr_manu.attr.lsef_length = 720;
	cfg.snr_cfg_node.cif.wdr_manu.attr.discard_padding_lines = 1;
	cfg.snr_cfg_node.cif.wdr_manu.attr.update = 1;

	memcpy(&cfg.snr_cfg_node.snsr, &snsr_cfg_test, sizeof(snsr_cfg_test.snsr));

	ISP_EXT_CTRL(ut_fd_isp, &cfg, V4L2_CID_DV_VIP_ISP_SET_SNR_CFG_NODE);

	ret = ut_v4l2_cmd(ut_fd_isp, VIDIOC_STREAMON, (void *)&data);
	if (ret != ERR_NONE)
		goto ERR;

	if (param->manual_mode)
		isp_tuning_ctrl(ut_fd_isp, i_cfg.s);

	_isp_stsBuf_init();

#define REPEAT_NUM 1000

	do {
		ret = isp_wait_event();
		if (ret != ERR_NONE)
			goto ERR;

		ISP_EXT_CTRL(ut_fd_isp, &cfg, V4L2_CID_DV_VIP_ISP_SET_SNR_CFG_NODE);

		ret = isp_DQbuf();
		if (ret != ERR_NONE)
			goto ERR;

		ret = isp_Qbuf();
		if (ret != ERR_NONE)
			goto ERR;
	} while (++repeat < REPEAT_NUM);

ERR:
	return ret;
}

enum cvi_errno isp_stop(void *priv)
{
	enum cvi_errno ret = ERR_NONE;
	int data = V4L2_BUF_TYPE_VIDEO_CAPTURE_MPLANE;

	ret = ut_v4l2_cmd(ut_fd_isp, VIDIOC_STREAMOFF, (void *)&data);
	if (ret != ERR_NONE)
		goto ERR;

	ret = _devm_release();
	if (ret != ERR_NONE)
		goto ERR;

	ret = ut_device_close(ut_fd_isp);
	if (ret != ERR_NONE)
		goto ERR;

ERR:
	return ret;
}

enum cvi_errno isp_msgrcv(void *priv)
{
	enum cvi_errno ret = ERR_NONE;

	struct msgpack *msg_pack = (struct msgpack *)priv;

	struct vip_msg_ctx *msg = (struct vip_msg_ctx *)msg_pack->msg_ctx;

	switch (msg->cmd) {
	case CSIBDG_CTRL: {
		struct snr_csibdg_info *csibdg_info = (struct snr_csibdg_info *)msg->indata;
		__u64 *ret_addr = (__u64 *)msg->retdata;

		struct cvi_isp_snr_ut_cfg cfg;

		cfg.hdr_on = csibdg_info->hdr_on;
		cfg.w = csibdg_info->w;
		cfg.h = csibdg_info->h;
		cfg.phy_addr[0] = 0;
		cfg.phy_addr[1] = 0;

		if (ut_fd_isp == 0)
			UT_DEV_INIT(dev_isp, ut_fd_isp);

		ISP_EXT_CTRL(ut_fd_isp, &cfg, V4L2_CID_DV_VIP_ISP_CSIBDG_CFG);

		ret_addr[0] = cfg.phy_addr[0];
		ret_addr[1] = cfg.phy_addr[1];

		ut_pr(UT_INFO, "[%s][%d] phy_addr_1=0x%llx\n", __func__, __LINE__, ret_addr[0]);
		if (cfg.hdr_on == 1)
			ut_pr(UT_INFO, "[%s][%d] phy_addr_2=0x%llx\n", __func__, __LINE__, ret_addr[1]);
	}
	break;

	case ISP_CTRL_RELEASE: {
		ut_device_close(ut_fd_isp);
	}
	break;

	default:
		break;
	}

	return ret;
}

/*************************************************************
 *	Instance	Creation
 *************************************************************/
MODULE_DECL("isp", isp);

struct module_op *isp_get_instance(void)
{
	return &isp_op;
}

